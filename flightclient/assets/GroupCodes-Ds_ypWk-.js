import{j as e,F as u,R as v,a as y,S,b as N,B as L,M as j}from"./bootstrap-C_lvuiKK.js";import{r as i}from"./vendor-D-ycbrtU.js";import{u as G,y as w}from"./index-DOI7CIXl.js";import"./router-Cwzx9i8E.js";const I=[{key:"groupId",label:"Group ID"},{key:"groupCode",label:"Group Code"},{key:"line",label:"Line"},{key:"lineCode",label:"Line Code"},{key:"opsCode",label:"Ops Code"},{key:"inlineLogo",label:"Inline Logo"},{key:"bulletLogo",label:"Bullet Logo"},{key:"backLogo",label:"Back Logo"},{key:"gateLogo",label:"Gate Logo"},{key:"firstNumber",label:"First Number"},{key:"lastNumber",label:"Last Number"},{key:"defaultLanguage",label:"Default Language"},{key:"siteId",label:"Site ID"}];function E(r,a,s,n){return r[s]==null&&a[s]==null?0:r[s]==null?1:a[s]==null?-1:typeof r[s]=="string"?n==="asc"?r[s].localeCompare(a[s]):a[s].localeCompare(r[s]):n==="asc"?r[s]-a[s]:a[s]-r[s]}const D=({group:r,onSave:a})=>{const[s,n]=i.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"mb-3 shadow-sm group-card-mini text-truncate",style:{cursor:"pointer",minWidth:0,maxWidth:260,width:"100%"},onClick:()=>n(!0),children:e.jsxs(N.Body,{className:"p-2 d-flex flex-column align-items-start justify-content-between",children:[e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"ID:"})," ",r.groupId]}),e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"Code:"})," ",r.groupCode]}),e.jsxs("div",{className:"mb-2 text-truncate",style:{width:"100%",fontSize:"0.85em",color:"#888"},children:[e.jsx("strong",{children:"Line:"})," ",r.line]}),e.jsx(L,{variant:"outline-primary",size:"sm",className:"align-self-end",onClick:g=>{g.stopPropagation(),n(!0)},children:"Details"})]})}),e.jsx(k,{show:s,onHide:()=>n(!1),group:r,onSave:a})]})};function k({show:r,onHide:a,group:s,onSave:n,mode:g="edit"}){const[m,h]=i.useState(s||{}),[x,c]=i.useState(!1),{authenticatedFetch:C}=G();i.useEffect(()=>{h(s||{})},[s,r]);const f=l=>{const{name:d,value:t,type:o,checked:p}=l.target;h(F=>({...F,[d]:o==="checkbox"?p:t}))},b=async()=>{c(!0);try{const l="https://dailyapisimple-gjchg7exhrcxf5cc.centralus-01.azurewebsites.net";let d,t;if(d=await C(`${l}/api/GroupCodes`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}),!d.ok)throw new Error("Failed to save group code");t=await d.json(),w.success("Group code updated"),n(t),a()}catch(l){w.error(l.message||"Error saving group code")}finally{c(!1)}};return e.jsxs(j,{show:r,onHide:a,size:"lg",centered:!0,contentClassName:"group-modal-responsive",children:[e.jsx(j.Header,{closeButton:!0,children:e.jsx(j.Title,{children:"Group Code Details"})}),e.jsx(j.Body,{style:{maxHeight:"60vh",overflowY:"auto",minHeight:200},children:e.jsx(u,{children:I.map(({key:l,label:d})=>e.jsxs(u.Group,{className:"mb-3",as:v,children:[e.jsx(u.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:d}),e.jsx(y,{sm:8,xs:7,children:e.jsx(u.Control,{name:l,value:m[l]??"",onChange:f,disabled:x||l==="groupId",readOnly:l==="groupId",type:typeof m[l]=="number"?"number":"text"})})]},l))})}),e.jsxs(j.Footer,{children:[e.jsx(L,{variant:"primary",onClick:b,disabled:x,children:x?e.jsx(S,{size:"sm",animation:"border"}):"Save"}),e.jsx(L,{variant:"secondary",onClick:a,disabled:x,children:"Cancel"})]})]})}const U=()=>{var d;const{user:r,authenticatedFetch:a}=G(),[s,n]=i.useState([]),[g,m]=i.useState(!0),[h,x]=i.useState({key:"groupId",direction:"asc"}),[c,C]=i.useState({line:"",groupCode:""});i.useEffect(()=>{m(!0),a("https://dailyapisimple-gjchg7exhrcxf5cc.centralus-01.azurewebsites.net/api/GroupCodes").then(o=>{if(!o.ok)throw new Error("Failed to fetch group codes");return o.json()}).then(o=>n(o)).catch(o=>w.error(o.message||"Error loading group codes")).finally(()=>m(!1))},[a]);const f=i.useMemo(()=>s.filter(t=>{const o=!c.line||(t.line||"").toLowerCase().includes(c.line.toLowerCase()),p=!c.groupCode||(t.groupCode||"").toLowerCase().includes(c.groupCode.toLowerCase());return o&&p}),[s,c]),b=i.useMemo(()=>[...f].sort((t,o)=>E(t,o,h.key,h.direction)),[f,h]),l=t=>{n(o=>o.map(p=>p.groupId===t.groupId?t:p))};return!r||!((d=r.roles)!=null&&d.includes("admin"))?e.jsx("div",{className:"mt-4 text-danger",children:"Access denied."}):e.jsxs("div",{className:"container mt-4",children:[e.jsx("h2",{className:"mb-3",children:"Group Codes"}),e.jsx(u,{className:"mb-3",children:e.jsxs(v,{className:"g-2",children:[e.jsx(y,{xs:12,sm:6,md:4,lg:3,xl:2,children:e.jsx(u.Control,{size:"sm",placeholder:"Filter by Group Code",value:c.groupCode,onChange:t=>C(o=>({...o,groupCode:t.target.value}))})}),e.jsx(y,{xs:12,sm:6,md:4,lg:3,xl:2,children:e.jsx(u.Control,{size:"sm",placeholder:"Filter by Line",value:c.line,onChange:t=>C(o=>({...o,line:t.target.value}))})})]})}),g?e.jsx("div",{className:"text-center my-5",children:e.jsx(S,{animation:"border"})}):e.jsx(v,{className:"g-2",children:b.map(t=>e.jsx(y,{xs:12,sm:6,md:4,lg:3,xl:2,xxl:2,children:e.jsx(D,{group:t,onSave:l})},t.groupId))}),b.length===0&&!g&&e.jsx("div",{children:"No group codes found."})]})};export{U as default};
//# sourceMappingURL=GroupCodes-Ds_ypWk-.js.map
