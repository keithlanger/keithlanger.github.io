import{j as e,C as F,y as S,r as f,a as O,R as k,b as P}from"./index-BdlzjqTp.js";import{h as I,S as B,M as v,F as u,B as T,P as b,f as N}from"./fields-DfTMlvG6.js";import{a as E}from"./Constants-yCI1ju8d.js";function D(){const i="https://abc.dev.cloudids.aero/images/";function h(t,l){l||(l="h:mm A");var o=I(t).format(l);return o}function x(t,l,o,m,s){var g;m||(m="default"),s||(s="en");var c=a(t,o),r=`${o}/${c}/${s}/${m}`.toLowerCase(),C=((g=l[r])==null?void 0:g.value)??c;return C}function a(t,l){var m,s,c;var o=(c=(s=(m=t==null?void 0:t.fields)==null?void 0:m[l])==null?void 0:s[0])==null?void 0:c.value;return o}function n(t,l){var m,s,c,r;var o=(r=(c=(s=(m=t==null?void 0:t.fieldGroups)==null?void 0:m.codeshares)==null?void 0:s[0])==null?void 0:c[l])==null?void 0:r.value;return o||(o=a(t,l)),o}function j(t,l){var o={id:t.id,adi:t==null?void 0:t.adi,schedule:h(t==null?void 0:t.schedule),iata:a(t,"city"),city:x(t,l,"city"),logo:i+n(t,"logo"),linecode:n(t,"linecode"),number:n(t,"number"),gate:a(t,"gate"),status:x(t,l,"status"),statusCode:a(t,"status"),linecodeNumber:n(t,"linecode")+" "+n(t,"number")};return o}return{getFormattedFlight:j,formatTime:h,getLookup:x,getDailyValue:a,getCodeshareField:n}}const y=new D;function A({flight:i,showFlight:h,fields:x}){var a=y.getFormattedFlight(i,x);return e.jsx(F,{className:"myCard",onClick:()=>h(i),children:e.jsxs(F.Body,{children:[e.jsxs(F.Title,{children:[i.id," (",i.adi,") ",a.linecode,a.number]}),e.jsxs(B,{children:[e.jsx("img",{src:a.logo}),e.jsx("div",{children:a.iata}),e.jsx("div",{children:a.city}),e.jsx("div",{children:a.gate}),e.jsx("div",{children:a.status}),e.jsx("div",{children:a.schedule})]})]})})}function L({flight:i,fields:h,show:x,handleClose:a}){const n="https://abc.dev.cloudids.aero/dailyapi/v3/api/Dailies",j=y.getFormattedFlight(i,h),t=s=>{console.log("Patching flight "+s.id);const c=n+"/"+s.id;fetch(c,{method:"PATCH",headers:{Authorization:`Bearer ${E}`,"Content-Type":"application/json"},body:JSON.stringify(s)}).then(r=>{if(!r.ok)throw new Error(`HTTP error! Status: ${r.status}`);return r.json()}).then(r=>{console.log("Patching flight succeeded - Data:",r),a(),S.success("Record was saved successfully")}).catch(r=>{console.error("Error Patching flight:",r),S.error("Record did not save successfully.  Error reported: "+r)})};function l(){return y.getCodeshareField(i,"linecode")+" "+y.getCodeshareField(i,"number")}function o(s,c,r){var C=i.fields[s];let g=!1;(!C||C.length==0||C[0].value!=c)&&(g=!0),g&&(r[s]=[{instance:1,value:c}],i.fields[s]=r[s])}const m=s=>{s.preventDefault(),console.log("Submit"),console.log(s.target);const c={};o("gate",s.target.gate.value,c),o("city",s.target.city.value,c),o("status",s.target.status.value,c);var r={id:i.id,fields:c};console.log("Updating flight"),console.log(r),t(r)};return e.jsxs(v,{show:x,onHide:a,children:[e.jsx(v.Header,{closeButton:!0,children:e.jsx(v.Title,{children:l()})}),e.jsx(v.Body,{children:e.jsxs(u,{onSubmit:m,children:[e.jsxs(u.Group,{className:"mb-3",controlId:"id",children:[e.jsx(u.Label,{children:"ID"}),e.jsx(u.Control,{type:"text",disabled:!0,value:i.id})]}),e.jsxs(u.Group,{className:"mb-3",controlId:"linecode_number",children:[e.jsx(u.Label,{children:"Flight"}),e.jsx(u.Control,{type:"text",disabled:!0,defaultValue:j.linecodeNumber})]}),e.jsxs(u.Group,{className:"mb-3",controlId:"gate",children:[e.jsx(u.Label,{children:"Gate"}),e.jsx(u.Control,{type:"text",defaultValue:j.gate})]}),e.jsxs(u.Group,{className:"mb-3",controlId:"city",children:[e.jsx(u.Label,{children:"City"}),e.jsx(u.Control,{type:"text",defaultValue:j.iata})]}),e.jsxs(u.Group,{className:"mb-3",controlId:"status",children:[e.jsx(u.Label,{children:"Status"}),e.jsx(u.Control,{type:"text",defaultValue:j.statusCode})]}),e.jsx(T,{type:"submit",variant:"primary",children:"Save Changes"}),e.jsx("span",{className:"p-2"}),e.jsx(T,{variant:"secondary",onClick:a,children:"Cancel"})]})}),e.jsx(v.Footer,{})]})}const R={Operation:"between",Field:"schedule",CompareTo:"2022-06-07T14:50:10+00:00",CompareToEnd:"2022-06-10T14:50:10+00:00",Negate:!1,And:[],Or:[{Operation:"between",Field:"actual",CompareTo:"2022-06-07T14:50:10+00:00",CompareToEnd:"2022-06-10T14:50:10+00:00",Negate:!1,And:[],Or:[]},{Operation:">",Field:"holdtime",CompareTo:"2022-06-08T14:50:10+00:00",CompareToEnd:null,Negate:!1,And:[],Or:[]}]},$=[],G={filter:R,fieldsToInclude:$},M=U(G),V="https://abc.dev.cloudids.aero/dailyapi/v3/api/Dailies";function U(i){var h=JSON.parse(JSON.stringify(i));const x=1e3,a=-240,n=new Date,j=w(n,a),t=w(n,x),l=j.toISOString(),o=t.toISOString(),m=n.toISOString(),s=h.filter;return s.CompareTo=l,s.CompareToEnd=o,s.Or[0].CompareTo=l,s.Or[0].CompareToEnd=o,s.Or[1].CompareTo=m,h}function w(i,h){return new Date(i.getTime()+h*6e4)}function _(){console.log("Using APVe APIs");const[i,h]=f.useState(!1),[x,a]=f.useState({}),[n,j]=f.useState(1),[t,l]=f.useState([]);let o=1;const m=()=>{console.log("Fetching data"),fetch(V+"/Search?skip=0&orderby=schedule&top="+10,{method:"POST",headers:{Authorization:`Bearer ${E}`,"Content-Type":"application/json"},body:JSON.stringify(M)}).then(p=>{if(!p.ok)throw new Error(`HTTP error! Status: ${p.status}`);return p.json()}).then(p=>{console.log("Data:",p),l(p)}).catch(p=>{console.error("Error fetching data:",p)})};f.useEffect(()=>{m()},[]);const s=()=>h(!1);function c(d){a(d),h(!0)}function r(d){d>=1&&d<=o?(console.log("Setting page to "+d),j(d)):console.log("Not setting page because page is out of range: "+d)}function C(d){var p=parseInt(d.target.text);console.log("itemClicked: "+p),r(p)}console.log("Current page: "+n);let g=[];for(let d=1;d<=o;d++)g.push(e.jsx(b.Item,{active:d===n,onClick:p=>C(p),children:d},d));return e.jsxs(e.Fragment,{children:[e.jsxs(O,{children:[e.jsxs(b,{children:[e.jsx(b.First,{onClick:()=>r(1),disabled:n==1}),e.jsx(b.Prev,{onClick:()=>r(n-1),disabled:n==1}),g,e.jsx(b.Next,{onClick:()=>r(n+1),disabled:n==o}),e.jsx(b.Last,{onClick:()=>r(o),disabled:n==o})]}),e.jsx(k,{xs:2,md:5,children:t.map(d=>e.jsx(P,{className:"mb-3",children:e.jsx(A,{flight:d,fields:N,showFlight:c})},d.id))})]}),e.jsx(L,{show:i,flight:x,fields:N,handleClose:s})]})}export{_ as default};
//# sourceMappingURL=Flights-C0a4jTwN.js.map
