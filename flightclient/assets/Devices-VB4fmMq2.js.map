{"version":3,"file":"Devices-VB4fmMq2.js","sources":["../../src/components/Devices.js"],"sourcesContent":["import React, { useEffect, useState, useMemo } from \"react\";\r\nimport Card from \"react-bootstrap/Card\";\r\nimport Button from \"react-bootstrap/Button\";\r\nimport Form from \"react-bootstrap/Form\";\r\nimport Row from \"react-bootstrap/Row\";\r\nimport Col from \"react-bootstrap/Col\";\r\nimport Spinner from \"react-bootstrap/Spinner\";\r\nimport Table from \"react-bootstrap/Table\";\r\nimport Modal from \"react-bootstrap/Modal\";\r\nimport { useAuth } from \"../contexts/AuthContext\";\r\nimport { toast } from \"react-toastify\";\r\n\r\nconst DEVICE_FIELDS = [\r\n  { key: \"id\", label: \"ID\" },\r\n  { key: \"name\", label: \"Name\" },\r\n  { key: \"siteId\", label: \"Site ID\" },\r\n  { key: \"ipAddress\", label: \"IP Address\" },\r\n  { key: \"uid\", label: \"UID\" },\r\n  { key: \"type\", label: \"Type\" },\r\n  { key: \"manufacturer\", label: \"Manufacturer\" },\r\n  { key: \"model\", label: \"Model\" },\r\n  { key: \"operatingSystem\", label: \"Operating System\" },\r\n  { key: \"active\", label: \"Active\" },\r\n  { key: \"deviceConfigurationId\", label: \"Device Config ID\" },\r\n  { key: \"availablePorts\", label: \"Available Ports\" },\r\n  { key: \"userAgentId\", label: \"User Agent ID\" },\r\n];\r\n\r\nfunction compare(a, b, key, direction) {\r\n  if (a[key] == null && b[key] == null) return 0;\r\n  if (a[key] == null) return 1;\r\n  if (b[key] == null) return -1;\r\n  if (typeof a[key] === \"string\") {\r\n    return direction === \"asc\"\r\n      ? a[key].localeCompare(b[key])\r\n      : b[key].localeCompare(a[key]);\r\n  }\r\n  return direction === \"asc\" ? a[key] - b[key] : b[key] - a[key];\r\n}\r\n\r\nconst DeviceCard = ({ device, onSave }) => {\r\n  const [show, setShow] = useState(false);\r\n  return (\r\n    <>\r\n      <Card\r\n        className=\"mb-3 shadow-sm device-card-mini text-truncate\"\r\n        style={{ cursor: \"pointer\", minWidth: 0, maxWidth: 260, width: \"100%\" }}\r\n        onClick={() => setShow(true)}\r\n      >\r\n        <Card.Body className=\"p-2 d-flex flex-column align-items-start justify-content-between\">\r\n          <div className=\"mb-1 text-truncate\" style={{ width: \"100%\" }}><strong>ID:</strong> {device.id}</div>\r\n          <div className=\"mb-1 text-truncate\" style={{ width: \"100%\" }}><strong>Name:</strong> {device.name}</div>\r\n          <div className=\"mb-2 text-truncate\" style={{ width: \"100%\", fontSize: \"0.85em\", color: \"#888\" }}><strong>UID:</strong> {device.uid}</div>\r\n          <Button variant=\"outline-primary\" size=\"sm\" className=\"align-self-end\" onClick={e => { e.stopPropagation(); setShow(true); }}>Details</Button>\r\n        </Card.Body>\r\n      </Card>\r\n      <DeviceDetailsModal show={show} onHide={() => setShow(false)} device={device} onSave={onSave} />\r\n    </>\r\n  );\r\n};\r\n\r\n\r\nfunction DeviceDetailsModal({ show, onHide, device, onSave, mode = \"edit\" }) {\r\n  // Extract user agent info if present\r\n  const userAgent = device?.links?.userAgent;\r\n  const [form, setForm] = useState(() => {\r\n    if (mode === \"add\") {\r\n      return { ...device, id: 0 };\r\n    }\r\n    return device || {};\r\n  });\r\n  const [saving, setSaving] = useState(false);\r\n  const { authenticatedFetch } = useAuth();\r\n\r\n  useEffect(() => {\r\n    if (mode === \"add\") {\r\n      setForm({ ...device, id: 0 });\r\n    } else {\r\n      setForm(device || {});\r\n    }\r\n  }, [device, show, mode]);\r\n\r\n  const handleChange = (e) => {\r\n    const { name, value, type, checked } = e.target;\r\n    setForm((f) => ({\r\n      ...f,\r\n      [name]: type === \"checkbox\" ? checked : value,\r\n    }));\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    setSaving(true);\r\n    try {\r\n      const baseUrl = import.meta.env.VITE_API_BASE_URL || \"\";\r\n      let resp, updated;\r\n      if (mode === \"add\") {\r\n        resp = await authenticatedFetch(`${baseUrl}/api/devices`, {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify(form),\r\n        });\r\n        if (!resp.ok) throw new Error(\"Failed to add device\");\r\n        updated = await resp.json();\r\n        toast.success(\"Device added\");\r\n      } else {\r\n        resp = await authenticatedFetch(`${baseUrl}/api/devices/${form.id}`, {\r\n          method: \"PUT\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify(form),\r\n        });\r\n        if (!resp.ok) throw new Error(\"Failed to save device\");\r\n        updated = await resp.json();\r\n        toast.success(\"Device updated\");\r\n      }\r\n      onSave(updated);\r\n      onHide();\r\n    } catch (e) {\r\n      toast.error(e.message || (mode === \"add\" ? \"Error adding device\" : \"Error saving device\"));\r\n    } finally {\r\n      setSaving(false);\r\n    }\r\n  };\r\n\r\n  // Split fields for two-column layout, removing userAgentId if userAgent is present\r\n  const filteredFields = userAgent\r\n    ? DEVICE_FIELDS.filter(f => f.key !== \"userAgentId\")\r\n    : DEVICE_FIELDS;\r\n  const leftFields = filteredFields.filter((_, i) => i % 2 === 0);\r\n  const rightFields = filteredFields.filter((_, i) => i % 2 === 1);\r\n\r\n  return (\r\n    <Modal show={show} onHide={onHide} size=\"lg\" centered contentClassName=\"device-modal-responsive\">\r\n      <Modal.Header closeButton>\r\n        <Modal.Title>{mode === \"add\" ? \"Add New Device\" : \"Device Details\"}</Modal.Title>\r\n      </Modal.Header>\r\n      <Modal.Body style={{ maxHeight: '60vh', overflowY: 'auto', minHeight: 200 }}>\r\n        <Form>\r\n          <Row>\r\n            <Col xs={12} lg={6}>\r\n              {leftFields.map(({ key, label }) => (\r\n                <Form.Group key={key} className=\"mb-3\" as={Row}>\r\n                  <Form.Label column sm={4} xs={5} style={{ fontWeight: 500 }}>{label}</Form.Label>\r\n                  <Col sm={8} xs={7}>\r\n                    {key === \"active\" ? (\r\n                      <Form.Check\r\n                        type=\"checkbox\"\r\n                        name={key}\r\n                        checked={!!form[key]}\r\n                        onChange={handleChange}\r\n                        disabled={saving}\r\n                      />\r\n                    ) : (\r\n                      <Form.Control\r\n                        name={key}\r\n                        value={form[key] ?? \"\"}\r\n                        onChange={handleChange}\r\n                        disabled={saving || key === \"id\" || key === \"userAgentId\"}\r\n                        readOnly={key === \"id\" || key === \"userAgentId\"}\r\n                        type={typeof form[key] === \"number\" ? \"number\" : \"text\"}\r\n                      />\r\n                    )}\r\n                  </Col>\r\n                </Form.Group>\r\n              ))}\r\n            </Col>\r\n            <Col xs={12} lg={6}>\r\n              {rightFields.map(({ key, label }) => (\r\n                <Form.Group key={key} className=\"mb-3\" as={Row}>\r\n                  <Form.Label column sm={4} xs={5} style={{ fontWeight: 500 }}>{label}</Form.Label>\r\n                  <Col sm={8} xs={7}>\r\n                    {key === \"active\" ? (\r\n                      <Form.Check\r\n                        type=\"checkbox\"\r\n                        name={key}\r\n                        checked={!!form[key]}\r\n                        onChange={handleChange}\r\n                        disabled={saving}\r\n                      />\r\n                    ) : (\r\n                      <Form.Control\r\n                        name={key}\r\n                        value={form[key] ?? \"\"}\r\n                        onChange={handleChange}\r\n                        disabled={saving || key === \"id\" || key === \"userAgentId\"}\r\n                        readOnly={key === \"id\" || key === \"userAgentId\"}\r\n                        type={typeof form[key] === \"number\" ? \"number\" : \"text\"}\r\n                      />\r\n                    )}\r\n                  </Col>\r\n                </Form.Group>\r\n              ))}\r\n            </Col>\r\n          </Row>\r\n        </Form>\r\n        {/* User Agent fields if present */}\r\n        {userAgent && (\r\n          <fieldset className=\"border rounded p-3 mb-3 bg-light\">\r\n            <legend className=\"w-auto mb-0 d-flex align-items-center\" style={{ fontSize: '1rem', fontWeight: 600 }}>\r\n              <span role=\"img\" aria-label=\"User Agent\" style={{ marginRight: 6 }}>üßë‚Äçüíª</span> User Agent Information\r\n            </legend>\r\n            <div className=\"d-flex flex-column gap-3\">\r\n              <Form.Group className=\"w-100 mb-0\" as={Row}>\r\n                <Form.Label column sm={5} xs={5} style={{ fontWeight: 500 }}>ID</Form.Label>\r\n                <Col sm={7} xs={7}>\r\n                  <Form.Control\r\n                    value={form.userAgentId ?? ''}\r\n                    readOnly\r\n                    disabled\r\n                    style={{ backgroundColor: '#e9ecef', color: '#495057' }}\r\n                  />\r\n                </Col>\r\n              </Form.Group>\r\n              {userAgent.userAgentText && (\r\n                <Form.Group className=\"w-100 mb-0\" as={Row}>\r\n                  <Form.Label column sm={5} xs={5} style={{ fontWeight: 500 }}>Agent</Form.Label>\r\n                  <Col sm={7} xs={7}>\r\n                    <Form.Control \r\n                      value={userAgent.userAgentText} \r\n                      readOnly \r\n                      style={{ backgroundColor: '#e9ecef', color: '#495057', fontWeight: 500 }}\r\n                    />\r\n                  </Col>\r\n                </Form.Group>\r\n              )}\r\n              {userAgent.description && (\r\n                <Form.Group className=\"w-100 mb-0\" as={Row}>\r\n                  <Form.Label column sm={5} xs={5} style={{ fontWeight: 500 }}>Description</Form.Label>\r\n                  <Col sm={7} xs={7}>\r\n                    <Form.Control \r\n                      value={userAgent.description} \r\n                      readOnly \r\n                      style={{ backgroundColor: '#e9ecef', color: '#495057' }}\r\n                    />\r\n                  </Col>\r\n                </Form.Group>\r\n              )}\r\n            </div>\r\n          </fieldset>\r\n        )}\r\n      </Modal.Body>\r\n      <Modal.Footer>\r\n        <Button variant=\"primary\" onClick={handleSave} disabled={saving}>\r\n          {saving ? <Spinner size=\"sm\" animation=\"border\" /> : mode === \"add\" ? \"Add\" : \"Save\"}\r\n        </Button>\r\n        <Button variant=\"secondary\" onClick={onHide} disabled={saving}>Cancel</Button>\r\n      </Modal.Footer>\r\n    </Modal>\r\n  );\r\n}\r\n\r\nconst DevicesScreen = () => {\r\n  const { user, authenticatedFetch } = useAuth();\r\n  const [devices, setDevices] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [filter, setFilter] = useState(DEVICE_FIELDS.reduce((acc, f) => ({ ...acc, [f.key]: \"\" }), {}));\r\n  const [showAdvanced, setShowAdvanced] = useState(false);\r\n  const [sort, setSort] = useState({ key: \"id\", direction: \"asc\" });\r\n\r\n  useEffect(() => {\r\n    setLoading(true);\r\n    const baseUrl = import.meta.env.VITE_API_BASE_URL || \"\";\r\n    authenticatedFetch(`${baseUrl}/api/devices`)\r\n      .then((r) => {\r\n        if (!r.ok) throw new Error(\"Failed to fetch devices\");\r\n        return r.json();\r\n      })\r\n      .then((data) => setDevices(data))\r\n      .catch((e) => toast.error(e.message || \"Error loading devices\"))\r\n      .finally(() => setLoading(false));\r\n  }, [authenticatedFetch]);\r\n\r\n  const filtered = useMemo(() => {\r\n    return devices.filter((d) =>\r\n      DEVICE_FIELDS.every(({ key }) => {\r\n        if (!filter[key]) return true;\r\n        return d[key]?.toString().toLowerCase().includes(filter[key].toLowerCase());\r\n      })\r\n    );\r\n  }, [devices, filter]);\r\n\r\n  const sorted = useMemo(() => {\r\n    return [...filtered].sort((a, b) => compare(a, b, sort.key, sort.direction));\r\n  }, [filtered, sort]);\r\n\r\n  const [showAdd, setShowAdd] = useState(false);\r\n  const handleSave = (updated) => {\r\n    setDevices((ds) => {\r\n      // If device already exists, update it; otherwise, add to front\r\n      const idx = ds.findIndex((d) => d.id === updated.id);\r\n      if (idx !== -1) {\r\n        return ds.map((d) => (d.id === updated.id ? updated : d));\r\n      } else {\r\n        return [updated, ...ds];\r\n      }\r\n    });\r\n  };\r\n\r\n  if (!user || !(user.roles?.includes(\"admin\") || user.roles?.includes(\"device\"))) {\r\n    return <div className=\"mt-4 text-danger\">Access denied.</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"container mt-4\">\r\n      <div className=\"d-flex justify-content-between align-items-center mb-2\">\r\n        <h2 className=\"mb-0\">Devices</h2>\r\n        <Button variant=\"success\" size=\"sm\" onClick={() => setShowAdd(true)}>\r\n          + Add new device\r\n        </Button>\r\n      </div>\r\n      <DeviceDetailsModal\r\n        show={showAdd}\r\n        onHide={() => setShowAdd(false)}\r\n        device={{}}\r\n        onSave={handleSave}\r\n        mode=\"add\"\r\n      />\r\n      <Table bordered size=\"sm\" className=\"mb-4\">\r\n        <thead>\r\n          <tr>\r\n            {(showAdvanced\r\n              ? DEVICE_FIELDS\r\n              : DEVICE_FIELDS.slice(0, 3)\r\n            ).map(({ key, label }) => (\r\n              <th key={key} style={{ cursor: \"pointer\" }} onClick={() => setSort((s) => ({\r\n                key,\r\n                direction: s.key === key && s.direction === \"asc\" ? \"desc\" : \"asc\"\r\n              }))}>\r\n                {label} {sort.key === key ? (sort.direction === \"asc\" ? \"‚ñ≤\" : \"‚ñº\") : null}\r\n              </th>\r\n            ))}\r\n          </tr>\r\n          <tr>\r\n            {(showAdvanced\r\n              ? DEVICE_FIELDS\r\n              : DEVICE_FIELDS.slice(0, 3)\r\n            ).map(({ key }) => (\r\n              <th key={key}>\r\n                <Form.Control\r\n                  size=\"sm\"\r\n                  placeholder=\"Filter\"\r\n                  value={filter[key]}\r\n                  onChange={(e) => setFilter((f) => ({ ...f, [key]: e.target.value }))}\r\n                />\r\n              </th>\r\n            ))}\r\n          </tr>\r\n          <tr>\r\n            <th colSpan={DEVICE_FIELDS.length} className=\"p-1 text-end\">\r\n              <Button\r\n                variant=\"outline-secondary\"\r\n                size=\"sm\"\r\n                onClick={() => setShowAdvanced((v) => !v)}\r\n                aria-expanded={showAdvanced}\r\n              >\r\n                {showAdvanced ? \"Hide advanced filters\" : \"Show advanced filters\"}\r\n              </Button>\r\n            </th>\r\n          </tr>\r\n        </thead>\r\n      </Table>\r\n      {loading ? (\r\n        <div className=\"text-center my-5\">\r\n          <Spinner animation=\"border\" />\r\n        </div>\r\n      ) : (\r\n        <Row className=\"g-2\">\r\n          {sorted.map((device) => (\r\n            <Col key={device.id} xs={12} sm={6} md={4} lg={3} xl={2} xxl={2}>\r\n              <DeviceCard device={device} onSave={handleSave} />\r\n            </Col>\r\n          ))}\r\n        </Row>\r\n      )}\r\n      {sorted.length === 0 && !loading && <div>No devices found.</div>}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DevicesScreen;\r\n"],"names":["DEVICE_FIELDS","compare","b","key","direction","DeviceCard","device","onSave","show","setShow","useState","jsxs","Fragment","jsx","Card","Button","e","DeviceDetailsModal","onHide","mode","userAgent","_a","form","setForm","saving","setSaving","authenticatedFetch","useAuth","useEffect","handleChange","name","value","type","checked","f","handleSave","baseUrl","resp","updated","toast","filteredFields","leftFields","_","i","rightFields","Modal","Form","Row","Col","label","Spinner","DevicesScreen","user","devices","setDevices","loading","setLoading","filter","setFilter","acc","showAdvanced","setShowAdvanced","sort","setSort","r","data","filtered","useMemo","d","sorted","a","showAdd","setShowAdd","ds","_b","Table","s","v"],"mappings":"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"}