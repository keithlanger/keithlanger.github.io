import{j as e,B as D,T as G,F as a,S as W,R as b,a as p,M as A,b as U}from"./bootstrap-B8JcjEJi.js";import{r as c}from"./vendor-CAgi6j6b.js";import{u as B,c as M,y as T}from"./index-Cx4Amvm4.js";import"./router-BUXXEe8L.js";const f=[{key:"id",label:"ID"},{key:"name",label:"Name"},{key:"siteId",label:"Site ID"},{key:"ipAddress",label:"IP Address"},{key:"uid",label:"UID"},{key:"type",label:"Type"},{key:"manufacturer",label:"Manufacturer"},{key:"model",label:"Model"},{key:"operatingSystem",label:"Operating System"},{key:"active",label:"Active"},{key:"deviceConfigurationId",label:"Device Config ID"},{key:"availablePorts",label:"Available Ports"},{key:"userAgentId",label:"User Agent ID"}];function R(n,d,r,m){return n[r]==null&&d[r]==null?0:n[r]==null?1:d[r]==null?-1:typeof n[r]=="string"?m==="asc"?n[r].localeCompare(d[r]):d[r].localeCompare(n[r]):m==="asc"?n[r]-d[r]:d[r]-n[r]}const H=({device:n,onSave:d})=>{const[r,m]=c.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"mb-3 shadow-sm device-card-mini text-truncate",style:{cursor:"pointer",minWidth:0,maxWidth:260,width:"100%"},onClick:()=>m(!0),children:e.jsxs(U.Body,{className:"p-2 d-flex flex-column align-items-start justify-content-between",children:[e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"ID:"})," ",n.id]}),e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"Name:"})," ",n.name]}),e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"Active:"})," ",n.active?"Yes":"No"]}),e.jsxs("div",{className:"mb-2 text-truncate",style:{width:"100%",fontSize:"0.85em",color:"#888"},children:[e.jsx("strong",{children:"UID:"})," ",n.uid]}),e.jsx(D,{variant:"outline-primary",size:"sm",className:"align-self-end",onClick:u=>{u.stopPropagation(),m(!0)},children:"Details"})]})}),e.jsx(P,{show:r,onHide:()=>m(!1),device:n,onSave:d})]})};function P({show:n,onHide:d,device:r,onSave:m,mode:u="edit"}){var N;const g=(N=r==null?void 0:r.links)==null?void 0:N.userAgent,[o,y]=c.useState(()=>u==="add"?{...r,id:0}:r||{}),[h,I]=c.useState(!1),{authenticatedFetch:j}=B();c.useEffect(()=>{y(u==="add"?{...r,id:0}:r||{})},[r,n,u]);const C=s=>{const{name:l,value:t,type:i,checked:x}=s.target;y(w=>({...w,[l]:i==="checkbox"?x:t}))},{apiBaseUrl:v,loading:O,error:E}=M(),F=async()=>{I(!0);try{if(!v)throw new Error("API base URL not loaded");let s,l;if(u==="add"){if(s=await j(`${v}/api/Devices`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),!s.ok)throw new Error("Failed to add device");l=await s.json(),T.success("Device added")}else{if(s=await j(`${v}/api/Devices/${o.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),!s.ok)throw new Error("Failed to save device");l=await s.json(),T.success("Device updated")}m(l),d()}catch(s){T.error(s.message||(u==="add"?"Error adding device":"Error saving device"))}finally{I(!1)}},S=g?f.filter(s=>s.key!=="userAgentId"):f,z=S.filter((s,l)=>l%2===0),L=S.filter((s,l)=>l%2===1);return e.jsxs(A,{show:n,onHide:d,size:"lg",centered:!0,contentClassName:"device-modal-responsive",children:[e.jsx(A.Header,{closeButton:!0,children:e.jsx(A.Title,{children:u==="add"?"Add New Device":"Device Details"})}),e.jsxs(A.Body,{style:{maxHeight:"60vh",overflowY:"auto",minHeight:200},children:[e.jsx(a,{children:e.jsxs(b,{children:[e.jsx(p,{xs:12,lg:6,children:z.map(({key:s,label:l})=>e.jsxs(a.Group,{className:"mb-3",as:b,children:[e.jsx(a.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:l}),e.jsx(p,{sm:8,xs:7,children:s==="active"?e.jsx(a.Check,{type:"checkbox",name:s,checked:!!o[s],onChange:C,disabled:h}):e.jsx(a.Control,{name:s,value:o[s]??"",onChange:C,disabled:h||s==="id"||s==="userAgentId",readOnly:s==="id"||s==="userAgentId",type:typeof o[s]=="number"?"number":"text"})})]},s))}),e.jsx(p,{xs:12,lg:6,children:L.map(({key:s,label:l})=>e.jsxs(a.Group,{className:"mb-3",as:b,children:[e.jsx(a.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:l}),e.jsx(p,{sm:8,xs:7,children:s==="active"?e.jsx(a.Check,{type:"checkbox",name:s,checked:!!o[s],onChange:C,disabled:h}):e.jsx(a.Control,{name:s,value:o[s]??"",onChange:C,disabled:h||s==="id"||s==="userAgentId",readOnly:s==="id"||s==="userAgentId",type:typeof o[s]=="number"?"number":"text"})})]},s))})]})}),g&&e.jsxs("fieldset",{className:"border rounded p-3 mb-3 bg-light",children:[e.jsxs("legend",{className:"w-auto mb-0 d-flex align-items-center",style:{fontSize:"1rem",fontWeight:600},children:[e.jsx("span",{role:"img","aria-label":"User Agent",style:{marginRight:6},children:"🧑‍💻"})," User Agent Information"]}),e.jsxs("div",{className:"d-flex flex-column gap-3",children:[e.jsxs(a.Group,{className:"w-100 mb-0",as:b,children:[e.jsx(a.Label,{column:!0,sm:5,xs:5,style:{fontWeight:500},children:"ID"}),e.jsx(p,{sm:7,xs:7,children:e.jsx(a.Control,{value:o.userAgentId??"",readOnly:!0,disabled:!0,style:{backgroundColor:"#e9ecef",color:"#495057"}})})]}),g.userAgentText&&e.jsxs(a.Group,{className:"w-100 mb-0",as:b,children:[e.jsx(a.Label,{column:!0,sm:5,xs:5,style:{fontWeight:500},children:"Agent"}),e.jsx(p,{sm:7,xs:7,children:e.jsx(a.Control,{value:g.userAgentText,readOnly:!0,style:{backgroundColor:"#e9ecef",color:"#495057",fontWeight:500}})})]}),g.description&&e.jsxs(a.Group,{className:"w-100 mb-0",as:b,children:[e.jsx(a.Label,{column:!0,sm:5,xs:5,style:{fontWeight:500},children:"Description"}),e.jsx(p,{sm:7,xs:7,children:e.jsx(a.Control,{value:g.description,readOnly:!0,style:{backgroundColor:"#e9ecef",color:"#495057"}})})]})]})]})]}),e.jsxs(A.Footer,{children:[e.jsx(D,{variant:"primary",onClick:F,disabled:h,children:h?e.jsx(W,{size:"sm",animation:"border"}):u==="add"?"Add":"Save"}),e.jsx(D,{variant:"secondary",onClick:d,disabled:h,children:"Cancel"})]})]})}const Y=()=>{var s,l;const{user:n,authenticatedFetch:d}=B(),[r,m]=c.useState([]),[u,g]=c.useState(!0),[o,y]=c.useState(f.reduce((t,i)=>({...t,[i.key]:""}),{})),[h,I]=c.useState(!1),[j,C]=c.useState({key:"id",direction:"asc"}),{apiBaseUrl:v,loading:O,error:E}=M();c.useEffect(()=>{v&&(g(!0),d(`${v}/api/devices`).then(t=>{if(!t.ok)throw new Error("Failed to fetch devices");return t.json()}).then(t=>m(t)).catch(t=>T.error(t.message||"Error loading devices")).finally(()=>g(!1)))},[d,v]);const F=c.useMemo(()=>r.filter(t=>f.every(({key:i})=>{var x;return o[i]?(x=t[i])==null?void 0:x.toString().toLowerCase().includes(o[i].toLowerCase()):!0})),[r,o]),S=c.useMemo(()=>[...F].sort((t,i)=>R(t,i,j.key,j.direction)),[F,j]),[z,L]=c.useState(!1),N=t=>{m(i=>i.findIndex(w=>w.id===t.id)!==-1?i.map(w=>w.id===t.id?t:w):[t,...i])};return O?e.jsx("div",{className:"mt-4",children:"Loading configuration..."}):E?e.jsxs("div",{className:"mt-4 text-danger",children:["Config error: ",E.message||E.toString()]}):!n||!((s=n.roles)!=null&&s.includes("admin")||(l=n.roles)!=null&&l.includes("device"))?e.jsx("div",{className:"mt-4 text-danger",children:"Access denied."}):e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("h2",{className:"mb-0",children:"Devices"}),e.jsx(D,{variant:"success",size:"sm",onClick:()=>L(!0),children:"+ Add new device"})]}),e.jsx(P,{show:z,onHide:()=>L(!1),device:{},onSave:N,mode:"add"}),e.jsx(G,{bordered:!0,size:"sm",className:"mb-4",children:e.jsxs("thead",{children:[e.jsx("tr",{children:(h?f:f.slice(0,3)).map(({key:t,label:i})=>e.jsxs("th",{style:{cursor:"pointer"},onClick:()=>C(x=>({key:t,direction:x.key===t&&x.direction==="asc"?"desc":"asc"})),children:[i," ",j.key===t?j.direction==="asc"?"▲":"▼":null]},t))}),e.jsx("tr",{children:(h?f:f.slice(0,3)).map(({key:t})=>e.jsx("th",{children:e.jsx(a.Control,{size:"sm",placeholder:"Filter",value:o[t],onChange:i=>y(x=>({...x,[t]:i.target.value}))})},t))}),e.jsx("tr",{children:e.jsx("th",{colSpan:f.length,className:"p-1 text-end",children:e.jsx(D,{variant:"outline-secondary",size:"sm",onClick:()=>I(t=>!t),"aria-expanded":h,children:h?"Hide advanced filters":"Show advanced filters"})})})]})}),u?e.jsx("div",{className:"text-center my-5",children:e.jsx(W,{animation:"border"})}):e.jsx(b,{className:"g-2",children:S.map(t=>e.jsx(p,{xs:12,sm:6,md:4,lg:3,xl:2,xxl:2,children:e.jsx(H,{device:t,onSave:N})},t.id))}),S.length===0&&!u&&e.jsx("div",{children:"No devices found."})]})};export{Y as default};
