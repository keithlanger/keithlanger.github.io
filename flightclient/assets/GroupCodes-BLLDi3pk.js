import{j as e,F as i,R as I,a as y,S as M,P as c,b as A,B as E,M as N}from"./bootstrap-9hNhFV_4.js";import{r as o}from"./vendor-D-ycbrtU.js";import{u as O,y as z}from"./index-Bu8ilBOl.js";import"./router-Cwzx9i8E.js";const B=[{key:"groupId",label:"Group ID"},{key:"groupCode",label:"Group Code"},{key:"line",label:"Line"},{key:"lineCode",label:"Line Code"},{key:"opsCode",label:"Ops Code"},{key:"inlineLogo",label:"Inline Logo"},{key:"bulletLogo",label:"Bullet Logo"},{key:"backLogo",label:"Back Logo"},{key:"gateLogo",label:"Gate Logo"},{key:"firstNumber",label:"First Number"},{key:"lastNumber",label:"Last Number"},{key:"defaultLanguage",label:"Default Language"},{key:"siteId",label:"Site ID"}],_=({group:m,onSave:h})=>{const[C,x]=o.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"mb-3 shadow-sm group-card-mini text-truncate",style:{cursor:"pointer",minWidth:0,maxWidth:260,width:"100%"},onClick:()=>x(!0),children:e.jsxs(A.Body,{className:"p-2 d-flex flex-column align-items-start justify-content-between",children:[e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"ID:"})," ",m.groupId]}),e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"Code:"})," ",m.groupCode]}),e.jsxs("div",{className:"mb-2 text-truncate",style:{width:"100%",fontSize:"0.85em",color:"#888"},children:[e.jsx("strong",{children:"Line:"})," ",m.line]}),e.jsx(E,{variant:"outline-primary",size:"sm",className:"align-self-end",onClick:S=>{S.stopPropagation(),x(!0)},children:"Details"})]})}),e.jsx(R,{show:C,onHide:()=>x(!1),group:m,onSave:h})]})};function R({show:m,onHide:h,group:C,onSave:x,mode:S="edit"}){const[p,k]=o.useState(C||{}),[v,d]=o.useState(!1),{authenticatedFetch:L}=O();o.useEffect(()=>{k(C||{})},[C,m]);const a=t=>{const{name:l,value:f,type:n,checked:F}=t.target;k(G=>({...G,[l]:n==="checkbox"?F:f}))},u=async()=>{d(!0);try{const t="https://dailyapisimple-gjchg7exhrcxf5cc.centralus-01.azurewebsites.net";let l,f;if(l=await L(`${t}/api/GroupCodes`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}),!l.ok)throw new Error("Failed to save group code");f=await l.json(),z.success("Group code updated"),x(f),h()}catch(t){z.error(t.message||"Error saving group code")}finally{d(!1)}},g=B.filter((t,l)=>l%2===0),w=B.filter((t,l)=>l%2===1);return e.jsxs(N,{show:m,onHide:h,size:"lg",centered:!0,contentClassName:"group-modal-responsive",children:[e.jsx(N.Header,{closeButton:!0,children:e.jsx(N.Title,{children:"Group Code Details"})}),e.jsx(N.Body,{style:{maxHeight:"60vh",overflowY:"auto",minHeight:200},children:e.jsx(i,{children:e.jsxs(I,{children:[e.jsx(y,{xs:12,lg:6,children:g.map(({key:t,label:l})=>e.jsxs(i.Group,{className:"mb-3",as:I,children:[e.jsx(i.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:l}),e.jsx(y,{sm:8,xs:7,children:e.jsx(i.Control,{name:t,value:p[t]??"",onChange:a,disabled:v||t==="groupId",readOnly:t==="groupId",type:typeof p[t]=="number"?"number":"text"})})]},t))}),e.jsx(y,{xs:12,lg:6,children:w.map(({key:t,label:l})=>e.jsxs(i.Group,{className:"mb-3",as:I,children:[e.jsx(i.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:l}),e.jsx(y,{sm:8,xs:7,children:e.jsx(i.Control,{name:t,value:p[t]??"",onChange:a,disabled:v||t==="groupId",readOnly:t==="groupId",type:typeof p[t]=="number"?"number":"text"})})]},t))})]})})}),e.jsxs(N.Footer,{children:[e.jsx(E,{variant:"primary",onClick:u,disabled:v,children:v?e.jsx(M,{size:"sm",animation:"border"}):"Save"}),e.jsx(E,{variant:"secondary",onClick:h,disabled:v,children:"Cancel"})]})]})}const $=()=>{var P;const{user:m,authenticatedFetch:h}=O(),[C,x]=o.useState([]),[S,p]=o.useState(!0),[k,v]=o.useState({key:"groupId",direction:"asc"}),[d,L]=o.useState({line:"",groupCode:""}),[a,u]=o.useState(1),[g,w]=o.useState(20),[t,l]=o.useState(0);o.useEffect(()=>{p(!0);const s="https://dailyapisimple-gjchg7exhrcxf5cc.centralus-01.azurewebsites.net",r=new URLSearchParams;r.append("skip",(a-1)*g),r.append("top",g),d.line&&r.append("line",d.line),d.groupCode&&r.append("groupCode",d.groupCode),h(`${s}/api/GroupCodes?${r.toString()}`).then(async j=>{if(!j.ok)throw new Error("Failed to fetch group codes");const D=j.headers.get("x-total-items"),b=await j.json();x(Array.isArray(b)?b:b.data||[]),l(D?parseInt(D,10):Array.isArray(b)?b.length:b.totalCount||(b.data?b.data.length:0))}).catch(j=>z.error(j.message||"Error loading group codes")).finally(()=>p(!1))},[h,a,g,d.line,d.groupCode]);const f=C,n=Math.max(1,Math.ceil(t/g)),F=f;o.useEffect(()=>{u(1)},[d,k,g]);const G=s=>{x(r=>r.map(j=>j.groupId===s.groupId?s:j))};return!m||!((P=m.roles)!=null&&P.includes("admin"))?e.jsx("div",{className:"mt-4 text-danger",children:"Access denied."}):e.jsxs("div",{className:"container mt-4",children:[e.jsx("h2",{className:"mb-3",children:"Group Codes"}),e.jsx(i,{className:"mb-3",children:e.jsxs(I,{className:"g-2 align-items-end",children:[e.jsx(y,{xs:12,sm:6,md:4,lg:3,xl:2,children:e.jsx(i.Control,{size:"sm",placeholder:"Filter by Group Code",value:d.groupCode,onChange:s=>L(r=>({...r,groupCode:s.target.value}))})}),e.jsx(y,{xs:12,sm:6,md:4,lg:3,xl:2,children:e.jsx(i.Control,{size:"sm",placeholder:"Filter by Line",value:d.line,onChange:s=>L(r=>({...r,line:s.target.value}))})})]})}),S?e.jsx("div",{className:"text-center my-5",children:e.jsx(M,{animation:"border"})}):e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"g-2",children:F.map(s=>e.jsx(y,{xs:12,sm:6,md:4,lg:3,xl:2,xxl:2,children:e.jsx(_,{group:s,onSave:G})},s.groupId))}),n>1&&e.jsxs("div",{className:"d-flex justify-content-center align-items-center gap-3 mt-3 flex-wrap",children:[e.jsxs(c,{className:"mb-0",children:[e.jsx(c.First,{onClick:()=>u(1),disabled:a===1}),e.jsx(c.Prev,{onClick:()=>u(s=>Math.max(1,s-1)),disabled:a===1}),e.jsx(c.Item,{active:a===1,onClick:()=>u(1),children:1}),a>4&&e.jsx(c.Ellipsis,{disabled:!0}),Array.from({length:2},(s,r)=>a-2+r).filter(s=>s>1&&s<a).map(s=>e.jsx(c.Item,{onClick:()=>u(s),children:s},s)),a!==1&&a!==n&&e.jsx(c.Item,{active:!0,children:a}),Array.from({length:2},(s,r)=>a+1+r).filter(s=>s<n&&s>a).map(s=>e.jsx(c.Item,{onClick:()=>u(s),children:s},s)),a<n-3&&e.jsx(c.Ellipsis,{disabled:!0}),n>1&&e.jsx(c.Item,{active:a===n,onClick:()=>u(n),children:n}),e.jsx(c.Next,{onClick:()=>u(s=>Math.min(n,s+1)),disabled:a===n}),e.jsx(c.Last,{onClick:()=>u(n),disabled:a===n})]}),e.jsxs(i.Group,{controlId:"pageSizeSelect",className:"mb-0",children:[e.jsx(i.Label,{visuallyHidden:!0,children:"Items per page"}),e.jsx(i.Select,{size:"sm",value:g,onChange:s=>w(Number(s.target.value)),children:[10,20,30,50,100].map(s=>e.jsxs("option",{value:s,children:[s," per page"]},s))})]})]})]}),f.length===0&&!S&&e.jsx("div",{children:"No group codes found."})]})};export{$ as default};
//# sourceMappingURL=GroupCodes-BLLDi3pk.js.map
