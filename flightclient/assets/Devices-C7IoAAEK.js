import{j as e,B as S,T as P,F as g,S as z,R as T,a as M,M as b,b as F}from"./bootstrap-C_lvuiKK.js";import{r as c}from"./vendor-D-ycbrtU.js";import{u as U,y as A}from"./index-DOI7CIXl.js";import"./router-Cwzx9i8E.js";const f=[{key:"id",label:"ID"},{key:"name",label:"Name"},{key:"siteId",label:"Site ID"},{key:"ipAddress",label:"IP Address"},{key:"uid",label:"UID"},{key:"type",label:"Type"},{key:"manufacturer",label:"Manufacturer"},{key:"model",label:"Model"},{key:"operatingSystem",label:"Operating System"},{key:"active",label:"Active"},{key:"deviceConfigurationId",label:"Device Config ID"},{key:"availablePorts",label:"Available Ports"},{key:"userAgentId",label:"User Agent ID"}];function B(r,n,t,o){return r[t]==null&&n[t]==null?0:r[t]==null?1:n[t]==null?-1:typeof r[t]=="string"?o==="asc"?r[t].localeCompare(n[t]):n[t].localeCompare(r[t]):o==="asc"?r[t]-n[t]:n[t]-r[t]}const L=({device:r,onSave:n})=>{const[t,o]=c.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"mb-3 shadow-sm device-card-mini text-truncate",style:{cursor:"pointer",minWidth:0,maxWidth:260,width:"100%"},onClick:()=>o(!0),children:e.jsxs(F.Body,{className:"p-2 d-flex flex-column align-items-start justify-content-between",children:[e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"ID:"})," ",r.id]}),e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"Name:"})," ",r.name]}),e.jsxs("div",{className:"mb-2 text-truncate",style:{width:"100%",fontSize:"0.85em",color:"#888"},children:[e.jsx("strong",{children:"UID:"})," ",r.uid]}),e.jsx(S,{variant:"outline-primary",size:"sm",className:"align-self-end",onClick:d=>{d.stopPropagation(),o(!0)},children:"Details"})]})}),e.jsx(k,{show:t,onHide:()=>o(!1),device:r,onSave:n})]})};function k({show:r,onHide:n,device:t,onSave:o,mode:d="edit"}){const[h,u]=c.useState(()=>d==="add"?{...t,id:0}:t||{}),[j,v]=c.useState(!1),{authenticatedFetch:w}=U();c.useEffect(()=>{u(d==="add"?{...t,id:0}:t||{})},[t,r,d]);const m=i=>{const{name:l,value:p,type:y,checked:C}=i.target;u(D=>({...D,[l]:y==="checkbox"?C:p}))},I=async()=>{v(!0);try{const i="https://dailyapisimple-gjchg7exhrcxf5cc.centralus-01.azurewebsites.net";let l,p;if(d==="add"){if(l=await w(`${i}/api/devices`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}),!l.ok)throw new Error("Failed to add device");p=await l.json(),A.success("Device added")}else{if(l=await w(`${i}/api/devices`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}),!l.ok)throw new Error("Failed to save device");p=await l.json(),A.success("Device updated")}o(p),n()}catch(i){A.error(i.message||(d==="add"?"Error adding device":"Error saving device"))}finally{v(!1)}};return e.jsxs(b,{show:r,onHide:n,size:"lg",centered:!0,contentClassName:"device-modal-responsive",children:[e.jsx(b.Header,{closeButton:!0,children:e.jsx(b.Title,{children:d==="add"?"Add New Device":"Device Details"})}),e.jsx(b.Body,{style:{maxHeight:"60vh",overflowY:"auto",minHeight:200},children:e.jsx(g,{children:f.map(({key:i,label:l})=>e.jsxs(g.Group,{className:"mb-3",as:T,children:[e.jsx(g.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:l}),e.jsx(M,{sm:8,xs:7,children:i==="active"?e.jsx(g.Check,{type:"checkbox",name:i,checked:!!h[i],onChange:m,disabled:j}):e.jsx(g.Control,{name:i,value:h[i]??"",onChange:m,disabled:j||i==="id",readOnly:i==="id",type:typeof h[i]=="number"?"number":"text"})})]},i))})}),e.jsxs(b.Footer,{children:[e.jsx(S,{variant:"primary",onClick:I,disabled:j,children:j?e.jsx(z,{size:"sm",animation:"border"}):d==="add"?"Add":"Save"}),e.jsx(S,{variant:"secondary",onClick:n,disabled:j,children:"Cancel"})]})]})}const $=()=>{var D,E;const{user:r,authenticatedFetch:n}=U(),[t,o]=c.useState([]),[d,h]=c.useState(!0),[u,j]=c.useState(f.reduce((s,a)=>({...s,[a.key]:""}),{})),[v,w]=c.useState(!1),[m,I]=c.useState({key:"id",direction:"asc"});c.useEffect(()=>{h(!0),n("https://dailyapisimple-gjchg7exhrcxf5cc.centralus-01.azurewebsites.net/api/devices").then(a=>{if(!a.ok)throw new Error("Failed to fetch devices");return a.json()}).then(a=>o(a)).catch(a=>A.error(a.message||"Error loading devices")).finally(()=>h(!1))},[n]);const i=c.useMemo(()=>t.filter(s=>f.every(({key:a})=>{var x;return u[a]?(x=s[a])==null?void 0:x.toString().toLowerCase().includes(u[a].toLowerCase()):!0})),[t,u]),l=c.useMemo(()=>[...i].sort((s,a)=>B(s,a,m.key,m.direction)),[i,m]),[p,y]=c.useState(!1),C=s=>{o(a=>a.findIndex(N=>N.id===s.id)!==-1?a.map(N=>N.id===s.id?s:N):[s,...a])};return!r||!((D=r.roles)!=null&&D.includes("admin")||(E=r.roles)!=null&&E.includes("device"))?e.jsx("div",{className:"mt-4 text-danger",children:"Access denied."}):e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("h2",{className:"mb-0",children:"Devices"}),e.jsx(S,{variant:"success",size:"sm",onClick:()=>y(!0),children:"+ Add new device"})]}),e.jsx(k,{show:p,onHide:()=>y(!1),device:{},onSave:C,mode:"add"}),e.jsx(P,{bordered:!0,size:"sm",className:"mb-4",children:e.jsxs("thead",{children:[e.jsx("tr",{children:(v?f:f.slice(0,3)).map(({key:s,label:a})=>e.jsxs("th",{style:{cursor:"pointer"},onClick:()=>I(x=>({key:s,direction:x.key===s&&x.direction==="asc"?"desc":"asc"})),children:[a," ",m.key===s?m.direction==="asc"?"▲":"▼":null]},s))}),e.jsx("tr",{children:(v?f:f.slice(0,3)).map(({key:s})=>e.jsx("th",{children:e.jsx(g.Control,{size:"sm",placeholder:"Filter",value:u[s],onChange:a=>j(x=>({...x,[s]:a.target.value}))})},s))}),e.jsx("tr",{children:e.jsx("th",{colSpan:f.length,className:"p-1 text-end",children:e.jsx(S,{variant:"outline-secondary",size:"sm",onClick:()=>w(s=>!s),"aria-expanded":v,children:v?"Hide advanced filters":"Show advanced filters"})})})]})}),d?e.jsx("div",{className:"text-center my-5",children:e.jsx(z,{animation:"border"})}):e.jsx(T,{className:"g-2",children:l.map(s=>e.jsx(M,{xs:12,sm:6,md:4,lg:3,xl:2,xxl:2,children:e.jsx(L,{device:s,onSave:C})},s.id))}),l.length===0&&!d&&e.jsx("div",{children:"No devices found."})]})};export{$ as default};
//# sourceMappingURL=Devices-C7IoAAEK.js.map
