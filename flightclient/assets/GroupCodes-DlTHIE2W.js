import{j as s,B as D,S as T,R as P,a as I,P as h,F as g,M as L,b as O}from"./bootstrap-loZ_3mSD.js";import{r as d}from"./vendor-CAgi6j6b.js";import{u as U,y as M,c as $}from"./index-2SwAigBq.js";import"./router-BUXXEe8L.js";const B=[{key:"id",label:"ID"},{key:"lineCode",label:"Line Code"},{key:"line",label:"Line"},{key:"firstNumber",label:"First Number"},{key:"lastNumber",label:"Last Number"},{key:"opsCode",label:"Ops Code"},{key:"inlineLogo",label:"Inline Logo"},{key:"bulletLogo",label:"Bullet Logo"},{key:"backLogo",label:"Back Logo"},{key:"gateLogo",label:"Gate Logo"},{key:"groupCode",label:"Group Code"},{key:"defaultLanguage",label:"Default Language"},{key:"siteId",label:"Site ID"}],H=({group:b,onSave:j})=>{const[p,f]=d.useState(!1);return s.jsxs(s.Fragment,{children:[s.jsx(O,{className:"mb-3 shadow-sm group-card-mini text-truncate",style:{cursor:"pointer",minWidth:0,maxWidth:260,width:"100%"},onClick:()=>f(!0),children:s.jsxs(O.Body,{className:"p-2 d-flex flex-column align-items-start justify-content-between",children:[s.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[s.jsx("strong",{children:"ID:"})," ",b.id]}),s.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[s.jsx("strong",{children:"Code:"})," ",b.groupCode]}),s.jsxs("div",{className:"mb-2 text-truncate",style:{width:"100%",fontSize:"0.85em",color:"#888"},children:[s.jsx("strong",{children:"Line:"})," ",b.line]}),s.jsx(D,{variant:"outline-primary",size:"sm",className:"align-self-end",onClick:m=>{m.stopPropagation(),f(!0)},children:"Details"})]})}),s.jsx(R,{show:p,onHide:()=>f(!1),group:b,onSave:j})]})};function R({show:b,onHide:j,group:p,onSave:f,mode:m="edit"}){const[t,v]=d.useState(p||{}),[C,a]=d.useState(!1),[c,u]=d.useState(""),{authenticatedFetch:F}=U(),{apiBaseUrl:y,loading:G,error:E}=$();d.useEffect(()=>{v(m==="add"?{id:0,siteId:1,firstNumber:1,lastNumber:9999,defaultLanguage:"en"}:p||{}),u("")},[p,b,m]);const S=e=>{const{name:r,value:i,type:n,checked:l}=e.target;v(N=>({...N,[r]:n==="checkbox"?l:i})),u("")},A=async()=>{if(!t.lineCode||!t.line||!t.groupCode||t.firstNumber===void 0||t.firstNumber===""||t.lastNumber===void 0||t.lastNumber===""){u("Line Code, Line, Group Code, First Number, and Last Number are required.");return}const e=Number(t.firstNumber),r=Number(t.lastNumber);if(isNaN(e)||isNaN(r)||e<1||e>9999||r<1||r>9999){u("First Number and Last Number must be numbers between 1 and 9999.");return}if(e>r){u("First Number must be less than or equal to Last Number.");return}if(!(G||!y)){if(E){u("API config error: "+E);return}a(!0);try{const i=y||"";let n,l;if(m==="add"){if(n=await F(`${i}/api/GroupCodes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),!n.ok){let N="Failed to create group code";try{const x=await n.json();x&&(x.error||x.message)&&(N=x.error||x.message)}catch{}throw new Error(N)}l=await n.json(),M.success("Group code created")}else{if(n=await F(`${y}/api/GroupCodes/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),!n.ok){let N="Failed to save group code";try{const x=await n.json();x&&(x.error||x.message)&&(N=x.error||x.message)}catch{}throw new Error(N)}l=await n.json(),M.success("Group code updated")}f(l,m),j()}catch(i){M.error(i.message||(m==="add"?"Error creating group code":"Error saving group code"))}finally{a(!1)}}},o=Math.ceil(B.length/2),z=B.slice(0,o),k=B.slice(o),w=e=>{if(!c)return!1;if(e==="lineCode"&&(!t.lineCode||t.lineCode==="")||e==="line"&&(!t.line||t.line==="")||e==="groupCode"&&(!t.groupCode||t.groupCode===""))return!0;if(e==="firstNumber"){const r=Number(t.firstNumber);return t.firstNumber===void 0||t.firstNumber===""||isNaN(r)||r<1||r>9999||t.lastNumber!==void 0&&t.lastNumber!==""&&r>Number(t.lastNumber)}if(e==="lastNumber"){const r=Number(t.lastNumber);return t.lastNumber===void 0||t.lastNumber===""||isNaN(r)||r<1||r>9999||t.firstNumber!==void 0&&t.firstNumber!==""&&Number(t.firstNumber)>r}return!1};return s.jsxs(L,{show:b,onHide:j,size:"lg",centered:!0,contentClassName:"group-modal-responsive",children:[s.jsx(L.Header,{closeButton:!0,children:s.jsx(L.Title,{children:m==="add"?"Add Group Code":"Group Code Details"})}),s.jsxs(L.Body,{style:{maxHeight:"60vh",overflowY:"auto",minHeight:200},children:[c&&s.jsx("div",{className:"alert alert-danger py-2 mb-3",role:"alert",style:{fontSize:"0.95em"},children:c}),s.jsx(g,{children:s.jsxs(P,{children:[s.jsx(I,{xs:12,lg:6,children:z.map(({key:e,label:r})=>s.jsxs(g.Group,{className:"mb-3",as:P,children:[s.jsx(g.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:r}),s.jsx(I,{sm:8,xs:7,children:s.jsx(g.Control,{name:e,value:t[e]??"",onChange:S,disabled:C||e==="id"||e==="siteId",readOnly:e==="id"||e==="siteId",type:typeof t[e]=="number"?"number":"text",tabIndex:e==="siteId"?-1:void 0,isInvalid:w(e)})})]},e))}),s.jsx(I,{xs:12,lg:6,children:k.map(({key:e,label:r})=>s.jsxs(g.Group,{className:"mb-3",as:P,children:[s.jsx(g.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:r}),s.jsx(I,{sm:8,xs:7,children:s.jsx(g.Control,{name:e,value:t[e]??"",onChange:S,disabled:C||e==="id"||e==="siteId",readOnly:e==="id"||e==="siteId",type:typeof t[e]=="number"?"number":"text",tabIndex:e==="siteId"?-1:void 0,isInvalid:w(e)})})]},e))})]})})]}),s.jsxs(L.Footer,{children:[s.jsx(D,{variant:"primary",onClick:A,disabled:C,children:C?s.jsx(T,{size:"sm",animation:"border"}):m==="add"?"Create":"Save"}),s.jsx(D,{variant:"secondary",onClick:j,disabled:C,children:"Cancel"})]})]})}const V=()=>{var w;const{user:b,authenticatedFetch:j}=U(),[p,f]=d.useState([]),[m,t]=d.useState(!0),[v,C]=d.useState({key:"id",direction:"asc"}),[a,c]=d.useState(1),[u,F]=d.useState(20),[y,G]=d.useState(0),[E,S]=d.useState(!1);d.useEffect(()=>{t(!0);const e="https://dailyapisimple-gjchg7exhrcxf5cc.centralus-01.azurewebsites.net",r=new URLSearchParams;r.append("skip",(a-1)*u),r.append("top",u),j(`${e}/api/GroupCodes?${r.toString()}`).then(async i=>{if(!i.ok)throw new Error("Failed to fetch group codes");const n=i.headers.get("x-total-items"),l=await i.json();f(Array.isArray(l)?l:l.data||[]),G(n?parseInt(n,10):Array.isArray(l)?l.length:l.totalCount||(l.data?l.data.length:0))}).catch(i=>M.error(i.message||"Error loading group codes")).finally(()=>t(!1))},[j,a,u]);const A=p,o=Math.max(1,Math.ceil((y||p.length)/u)),z=A;d.useEffect(()=>{c(1)},[v,u]);const k=(e,r)=>{r==="add"?(f(i=>[e,...i]),G(i=>i+1)):f(i=>i.map(n=>n.id===e.id?e:n))};return!b||!((w=b.roles)!=null&&w.includes("admin"))?s.jsx("div",{className:"mt-4 text-danger",children:"Access denied."}):s.jsxs("div",{className:"container mt-4",children:[s.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[s.jsx("h2",{className:"mb-0",children:"Group Codes"}),s.jsx(D,{variant:"success",onClick:()=>S(!0),children:"+ Add Group Code"})]}),s.jsx(R,{show:E,onHide:()=>S(!1),mode:"add",onSave:k}),m?s.jsx("div",{className:"text-center my-5",children:s.jsx(T,{animation:"border"})}):s.jsxs(s.Fragment,{children:[s.jsx(P,{className:"g-2",children:z.map(e=>s.jsx(I,{xs:12,sm:6,md:4,lg:3,xl:2,xxl:2,children:s.jsx(H,{group:e,onSave:k})},e.id))}),p.length>0&&s.jsxs("div",{className:"d-flex justify-content-center align-items-center gap-3 mt-3 flex-wrap",children:[s.jsxs(h,{className:"mb-0",children:[s.jsx(h.First,{onClick:()=>c(1),disabled:a===1}),s.jsx(h.Prev,{onClick:()=>c(e=>Math.max(1,e-1)),disabled:a===1}),s.jsx(h.Item,{active:a===1,onClick:()=>c(1),children:1}),a>4&&s.jsx(h.Ellipsis,{disabled:!0}),Array.from({length:2},(e,r)=>a-2+r).filter(e=>e>1&&e<a).map(e=>s.jsx(h.Item,{onClick:()=>c(e),children:e},e)),a!==1&&a!==o&&s.jsx(h.Item,{active:!0,children:a}),Array.from({length:2},(e,r)=>a+1+r).filter(e=>e<o&&e>a).map(e=>s.jsx(h.Item,{onClick:()=>c(e),children:e},e)),a<o-3&&s.jsx(h.Ellipsis,{disabled:!0}),o>1&&s.jsx(h.Item,{active:a===o,onClick:()=>c(o),children:o}),s.jsx(h.Next,{onClick:()=>c(e=>Math.min(o,e+1)),disabled:a===o}),s.jsx(h.Last,{onClick:()=>c(o),disabled:a===o})]}),s.jsxs(g.Group,{controlId:"pageSizeSelect",className:"mb-0",children:[s.jsx(g.Label,{visuallyHidden:!0,children:"Items per page"}),s.jsx(g.Select,{size:"sm",value:u,onChange:e=>F(Number(e.target.value)),children:[10,20,30,50,100].map(e=>s.jsxs("option",{value:e,children:[e," per page"]},e))})]})]})]}),A.length===0&&!m&&s.jsx("div",{children:"No group codes found."})]})};export{V as default};
