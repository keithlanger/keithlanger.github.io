import{j as e,F as c,R as g,a as j,S as F,b as y,B as S,M as f}from"./bootstrap-loZ_3mSD.js";import{r as o}from"./vendor-CAgi6j6b.js";import{u as E,y as w}from"./index-CwgVr1bl.js";import"./router-BUXXEe8L.js";const U=[{key:"id",label:"ID"},{key:"userName",label:"User Name"},{key:"userDescription",label:"User Description"},{key:"name1",label:"Name 1"},{key:"name2",label:"Name 2"},{key:"active",label:"Active"}];function L(a,n,r,i){return a[r]==null&&n[r]==null?0:a[r]==null?1:n[r]==null?-1:typeof a[r]=="string"?i==="asc"?a[r].localeCompare(n[r]):n[r].localeCompare(a[r]):i==="asc"?a[r]-n[r]:n[r]-a[r]}const B=({user:a,onSave:n})=>{const[r,i]=o.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"mb-3 shadow-sm user-card-mini text-truncate",style:{cursor:"pointer",minWidth:0,maxWidth:260,width:"100%"},onClick:()=>i(!0),children:e.jsxs(y.Body,{className:"p-2 d-flex flex-column align-items-start justify-content-between",children:[e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"ID:"})," ",a.id]}),e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"Name:"})," ",a.userName]}),e.jsxs("div",{className:"mb-2 text-truncate",style:{width:"100%",fontSize:"0.85em",color:"#888"},children:[e.jsx("strong",{children:"Active:"})," ",a.active?"Yes":"No"]}),e.jsx(S,{variant:"outline-primary",size:"sm",className:"align-self-end",onClick:p=>{p.stopPropagation(),i(!0)},children:"Details"})]})}),e.jsx(A,{show:r,onHide:()=>i(!1),user:a,onSave:n})]})};function A({show:a,onHide:n,user:r,onSave:i,mode:p="edit"}){const[l,x]=o.useState(r||{}),[d,m]=o.useState(!1),{authenticatedFetch:N}=E();o.useEffect(()=>{x(r||{})},[r,a]);const u=s=>{const{name:t,value:h,type:D,checked:z}=s.target;x(M=>({...M,[t]:D==="checkbox"?z:h}))},b=async()=>{m(!0);try{const s="https://dailyapisimple-container2.azurewebsites.net";let t,h;if(t=await N(`${s}/v2/api/users/${l.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),!t.ok)throw new Error("Failed to save user");h=await t.json(),w.success("User updated"),i(h),n()}catch(s){w.error(s.message||"Error saving user")}finally{m(!1)}},C=U.filter((s,t)=>t%2===0),v=U.filter((s,t)=>t%2===1);return e.jsxs(f,{show:a,onHide:n,size:"lg",centered:!0,contentClassName:"user-modal-responsive",children:[e.jsx(f.Header,{closeButton:!0,children:e.jsx(f.Title,{children:"User Details"})}),e.jsx(f.Body,{style:{maxHeight:"60vh",overflowY:"auto",minHeight:200},children:e.jsx(c,{children:e.jsxs(g,{children:[e.jsx(j,{xs:12,lg:6,children:C.map(({key:s,label:t})=>e.jsxs(c.Group,{className:"mb-3",as:g,children:[e.jsx(c.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:t}),e.jsx(j,{sm:8,xs:7,children:s==="active"?e.jsx(c.Check,{type:"checkbox",name:s,checked:!!l[s],onChange:u,disabled:d}):e.jsx(c.Control,{name:s,value:l[s]??"",onChange:u,disabled:d||s==="id",readOnly:s==="id",type:typeof l[s]=="number"?"number":"text"})})]},s))}),e.jsx(j,{xs:12,lg:6,children:v.map(({key:s,label:t})=>e.jsxs(c.Group,{className:"mb-3",as:g,children:[e.jsx(c.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:t}),e.jsx(j,{sm:8,xs:7,children:s==="active"?e.jsx(c.Check,{type:"checkbox",name:s,checked:!!l[s],onChange:u,disabled:d}):e.jsx(c.Control,{name:s,value:l[s]??"",onChange:u,disabled:d||s==="id",readOnly:s==="id",type:typeof l[s]=="number"?"number":"text"})})]},s))})]})})}),e.jsxs(f.Footer,{children:[e.jsx(S,{variant:"primary",onClick:b,disabled:d,children:d?e.jsx(F,{size:"sm",animation:"border"}):"Save"}),e.jsx(S,{variant:"secondary",onClick:n,disabled:d,children:"Cancel"})]})]})}const T=()=>{var v;const{user:a,authenticatedFetch:n}=E(),[r,i]=o.useState([]),[p,l]=o.useState(!0),[x,d]=o.useState({key:"id",direction:"asc"}),[m,N]=o.useState({userName:""});o.useEffect(()=>{l(!0),n("https://dailyapisimple-container2.azurewebsites.net/v2/api/users").then(t=>{if(!t.ok)throw new Error("Failed to fetch users");return t.json()}).then(t=>i(t)).catch(t=>w.error(t.message||"Error loading users")).finally(()=>l(!1))},[n]);const u=o.useMemo(()=>r.filter(s=>!m.userName||(s.userName||"").toLowerCase().includes(m.userName.toLowerCase())),[r,m]),b=o.useMemo(()=>[...u].sort((s,t)=>L(s,t,x.key,x.direction)),[u,x]),C=s=>{i(t=>t.map(h=>h.id===s.id?s:h))};return!a||!((v=a.roles)!=null&&v.includes("admin"))?e.jsx("div",{className:"mt-4 text-danger",children:"Access denied."}):e.jsxs("div",{className:"container mt-4",children:[e.jsx("h2",{className:"mb-3",children:"Users"}),e.jsx(c,{className:"mb-3",children:e.jsx(g,{className:"g-2",children:e.jsx(j,{xs:12,sm:6,md:4,lg:3,xl:2,children:e.jsx(c.Control,{size:"sm",placeholder:"Filter by User Name",value:m.userName,onChange:s=>N(t=>({...t,userName:s.target.value}))})})})}),p?e.jsx("div",{className:"text-center my-5",children:e.jsx(F,{animation:"border"})}):e.jsx(g,{className:"g-2",children:b.map(s=>e.jsx(j,{xs:12,sm:6,md:4,lg:3,xl:2,xxl:2,children:e.jsx(B,{user:s,onSave:C})},s.id))}),b.length===0&&!p&&e.jsx("div",{children:"No users found."})]})};export{T as default};
