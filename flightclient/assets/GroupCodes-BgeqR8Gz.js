import{j as e,B as D,S as T,R as M,a as F,P as g,F as b,M as E,b as z}from"./bootstrap-loZ_3mSD.js";import{r as c}from"./vendor-CAgi6j6b.js";import{u as U,c as R,y as B}from"./index-BPZDyB2a.js";import"./router-BUXXEe8L.js";const O=[{key:"id",label:"ID"},{key:"lineCode",label:"Line Code"},{key:"line",label:"Line"},{key:"firstNumber",label:"First Number"},{key:"lastNumber",label:"Last Number"},{key:"opsCode",label:"Ops Code"},{key:"inlineLogo",label:"Inline Logo"},{key:"bulletLogo",label:"Bullet Logo"},{key:"backLogo",label:"Back Logo"},{key:"gateLogo",label:"Gate Logo"},{key:"groupCode",label:"Group Code"},{key:"defaultLanguage",label:"Default Language"},{key:"siteId",label:"Site ID"}],H=({group:x,onSave:j})=>{const[f,p]=c.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"mb-3 shadow-sm group-card-mini text-truncate",style:{cursor:"pointer",minWidth:0,maxWidth:260,width:"100%"},onClick:()=>p(!0),children:e.jsxs(z.Body,{className:"p-2 d-flex flex-column align-items-start justify-content-between",children:[e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"ID:"})," ",x.id]}),e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"Code:"})," ",x.groupCode]}),e.jsxs("div",{className:"mb-2 text-truncate",style:{width:"100%",fontSize:"0.85em",color:"#888"},children:[e.jsx("strong",{children:"Line:"})," ",x.line]}),e.jsx(D,{variant:"outline-primary",size:"sm",className:"align-self-end",onClick:h=>{h.stopPropagation(),p(!0)},children:"Details"})]})}),e.jsx($,{show:f,onHide:()=>p(!1),group:x,onSave:j})]})};function $({show:x,onHide:j,group:f,onSave:p,mode:h="edit"}){const[t,y]=c.useState(f||{}),[C,n]=c.useState(!1),[u,m]=c.useState(""),{authenticatedFetch:G}=U(),{apiBaseUrl:S,loading:k,error:A}=R();c.useEffect(()=>{y(h==="add"?{id:0,siteId:1,firstNumber:1,lastNumber:9999,defaultLanguage:"en"}:f||{}),m("")},[f,x,h]);const w=r=>{const{name:a,value:N,type:s,checked:o}=r.target;y(l=>({...l,[a]:s==="checkbox"?o:N})),m("")},L=async()=>{if(!t.lineCode||!t.line||!t.groupCode||t.firstNumber===void 0||t.firstNumber===""||t.lastNumber===void 0||t.lastNumber===""){m("Line Code, Line, Group Code, First Number, and Last Number are required.");return}const r=Number(t.firstNumber),a=Number(t.lastNumber);if(isNaN(r)||isNaN(a)||r<1||r>9999||a<1||a>9999){m("First Number and Last Number must be numbers between 1 and 9999.");return}if(r>a){m("First Number must be less than or equal to Last Number.");return}if(!(k||!S)){if(A){m("API config error: "+A);return}n(!0);try{const N=S||"";let s,o;if(h==="add"){if(s=await G(`${N}/api/GroupCodes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),!s.ok){let l="Failed to create group code";try{const i=await s.json();i&&(i.error||i.message)&&(l=i.error||i.message)}catch{}throw new Error(l)}o=await s.json(),B.success("Group code created")}else{if(s=await G(`${S}/api/GroupCodes/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),!s.ok){let l="Failed to save group code";try{const i=await s.json();i&&(i.error||i.message)&&(l=i.error||i.message)}catch{}throw new Error(l)}o=await s.json(),B.success("Group code updated")}p(o,h),j()}catch(N){B.error(N.message||(h==="add"?"Error creating group code":"Error saving group code"))}finally{n(!1)}}},v=Math.ceil(O.length/2),I=O.slice(0,v),P=O.slice(v),d=r=>{if(!u)return!1;if(r==="lineCode"&&(!t.lineCode||t.lineCode==="")||r==="line"&&(!t.line||t.line==="")||r==="groupCode"&&(!t.groupCode||t.groupCode===""))return!0;if(r==="firstNumber"){const a=Number(t.firstNumber);return t.firstNumber===void 0||t.firstNumber===""||isNaN(a)||a<1||a>9999||t.lastNumber!==void 0&&t.lastNumber!==""&&a>Number(t.lastNumber)}if(r==="lastNumber"){const a=Number(t.lastNumber);return t.lastNumber===void 0||t.lastNumber===""||isNaN(a)||a<1||a>9999||t.firstNumber!==void 0&&t.firstNumber!==""&&Number(t.firstNumber)>a}return!1};return e.jsxs(E,{show:x,onHide:j,size:"lg",centered:!0,contentClassName:"group-modal-responsive",children:[e.jsx(E.Header,{closeButton:!0,children:e.jsx(E.Title,{children:h==="add"?"Add Group Code":"Group Code Details"})}),e.jsxs(E.Body,{style:{maxHeight:"60vh",overflowY:"auto",minHeight:200},children:[u&&e.jsx("div",{className:"alert alert-danger py-2 mb-3",role:"alert",style:{fontSize:"0.95em"},children:u}),e.jsx(b,{children:e.jsxs(M,{children:[e.jsx(F,{xs:12,lg:6,children:I.map(({key:r,label:a})=>e.jsxs(b.Group,{className:"mb-3",as:M,children:[e.jsx(b.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:a}),e.jsx(F,{sm:8,xs:7,children:e.jsx(b.Control,{name:r,value:t[r]??"",onChange:w,disabled:C||r==="id"||r==="siteId",readOnly:r==="id"||r==="siteId",type:typeof t[r]=="number"?"number":"text",tabIndex:r==="siteId"?-1:void 0,isInvalid:d(r)})})]},r))}),e.jsx(F,{xs:12,lg:6,children:P.map(({key:r,label:a})=>e.jsxs(b.Group,{className:"mb-3",as:M,children:[e.jsx(b.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:a}),e.jsx(F,{sm:8,xs:7,children:e.jsx(b.Control,{name:r,value:t[r]??"",onChange:w,disabled:C||r==="id"||r==="siteId",readOnly:r==="id"||r==="siteId",type:typeof t[r]=="number"?"number":"text",tabIndex:r==="siteId"?-1:void 0,isInvalid:d(r)})})]},r))})]})})]}),e.jsxs(E.Footer,{children:[e.jsx(D,{variant:"primary",onClick:L,disabled:C,children:C?e.jsx(T,{size:"sm",animation:"border"}):h==="add"?"Create":"Save"}),e.jsx(D,{variant:"secondary",onClick:j,disabled:C,children:"Cancel"})]})]})}const V=()=>{var N;const{user:x,authenticatedFetch:j}=U(),[f,p]=c.useState([]),[h,t]=c.useState(!0),[y,C]=c.useState({key:"id",direction:"asc"}),[n,u]=c.useState(1),[m,G]=c.useState(20),[S,k]=c.useState(0),[A,w]=c.useState(!1),{apiBaseUrl:L,loading:v,error:I}=R();if(c.useEffect(()=>{if(v||!L)return;t(!0);const s=new URLSearchParams;s.append("skip",(n-1)*m),s.append("top",m),j(`${L}/api/GroupCodes?${s.toString()}`).then(async o=>{if(!o.ok)throw new Error("Failed to fetch group codes");const l=o.headers.get("x-total-items"),i=await o.json();p(Array.isArray(i)?i:i.data||[]),k(l?parseInt(l,10):Array.isArray(i)?i.length:i.totalCount||(i.data?i.data.length:0))}).catch(o=>B.error(o.message||"Error loading group codes")).finally(()=>t(!1))},[j,n,m,L,v]),v)return e.jsx("div",{className:"mt-4",children:"Loading configuration..."});if(I)return e.jsxs("div",{className:"mt-4 text-danger",children:["Config error: ",I.message||I.toString()]});const P=f,d=Math.max(1,Math.ceil((S||f.length)/m)),r=P;c.useEffect(()=>{u(1)},[y,m]);const a=(s,o)=>{o==="add"?(p(l=>[s,...l]),k(l=>l+1)):p(l=>l.map(i=>i.id===s.id?s:i))};return!x||!((N=x.roles)!=null&&N.includes("admin"))?e.jsx("div",{className:"mt-4 text-danger",children:"Access denied."}):e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h2",{className:"mb-0",children:"Group Codes"}),e.jsx(D,{variant:"success",onClick:()=>w(!0),children:"+ Add Group Code"})]}),e.jsx($,{show:A,onHide:()=>w(!1),mode:"add",onSave:a}),h?e.jsx("div",{className:"text-center my-5",children:e.jsx(T,{animation:"border"})}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"g-2",children:r.map(s=>e.jsx(F,{xs:12,sm:6,md:4,lg:3,xl:2,xxl:2,children:e.jsx(H,{group:s,onSave:a})},s.id))}),f.length>0&&e.jsxs("div",{className:"d-flex justify-content-center align-items-center gap-3 mt-3 flex-wrap",children:[e.jsxs(g,{className:"mb-0",children:[e.jsx(g.First,{onClick:()=>u(1),disabled:n===1}),e.jsx(g.Prev,{onClick:()=>u(s=>Math.max(1,s-1)),disabled:n===1}),e.jsx(g.Item,{active:n===1,onClick:()=>u(1),children:1}),n>4&&e.jsx(g.Ellipsis,{disabled:!0}),Array.from({length:2},(s,o)=>n-2+o).filter(s=>s>1&&s<n).map(s=>e.jsx(g.Item,{onClick:()=>u(s),children:s},s)),n!==1&&n!==d&&e.jsx(g.Item,{active:!0,children:n}),Array.from({length:2},(s,o)=>n+1+o).filter(s=>s<d&&s>n).map(s=>e.jsx(g.Item,{onClick:()=>u(s),children:s},s)),n<d-3&&e.jsx(g.Ellipsis,{disabled:!0}),d>1&&e.jsx(g.Item,{active:n===d,onClick:()=>u(d),children:d}),e.jsx(g.Next,{onClick:()=>u(s=>Math.min(d,s+1)),disabled:n===d}),e.jsx(g.Last,{onClick:()=>u(d),disabled:n===d})]}),e.jsxs(b.Group,{controlId:"pageSizeSelect",className:"mb-0",children:[e.jsx(b.Label,{visuallyHidden:!0,children:"Items per page"}),e.jsx(b.Select,{size:"sm",value:m,onChange:s=>G(Number(s.target.value)),children:[10,20,30,50,100].map(s=>e.jsxs("option",{value:s,children:[s," per page"]},s))})]})]})]}),P.length===0&&!h&&e.jsx("div",{children:"No group codes found."})]})};export{V as default};
