import{j as e,F as d,R as N,a as f,S as D,b as F,B as y,M as v}from"./bootstrap-loZ_3mSD.js";import{r as m}from"./vendor-CAgi6j6b.js";import{u as L,y as S,c as I}from"./index-2SwAigBq.js";import"./router-BUXXEe8L.js";const E=[{key:"id",label:"ID"},{key:"userName",label:"User Name"},{key:"userDescription",label:"User Description"},{key:"name1",label:"Name 1"},{key:"name2",label:"Name 2"},{key:"active",label:"Active"}];function R(r,a,t,o){return r[t]==null&&a[t]==null?0:r[t]==null?1:a[t]==null?-1:typeof r[t]=="string"?o==="asc"?r[t].localeCompare(a[t]):a[t].localeCompare(r[t]):o==="asc"?r[t]-a[t]:a[t]-r[t]}const W=({user:r,onSave:a})=>{const[t,o]=m.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"mb-3 shadow-sm user-card-mini text-truncate",style:{cursor:"pointer",minWidth:0,maxWidth:260,width:"100%"},onClick:()=>o(!0),children:e.jsxs(F.Body,{className:"p-2 d-flex flex-column align-items-start justify-content-between",children:[e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"ID:"})," ",r.id]}),e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"Name:"})," ",r.userName]}),e.jsxs("div",{className:"mb-2 text-truncate",style:{width:"100%",fontSize:"0.85em",color:"#888"},children:[e.jsx("strong",{children:"Active:"})," ",r.active?"Yes":"No"]}),e.jsx(y,{variant:"outline-primary",size:"sm",className:"align-self-end",onClick:p=>{p.stopPropagation(),o(!0)},children:"Details"})]})}),e.jsx(O,{show:t,onHide:()=>o(!1),user:r,onSave:a})]})};function O({show:r,onHide:a,user:t,onSave:o,mode:p="edit"}){const[c,j]=m.useState(t||{}),[u,h]=m.useState(!1),{authenticatedFetch:w}=L();m.useEffect(()=>{j(t||{})},[t,r]);const x=s=>{const{name:l,value:M,type:z,checked:A}=s.target;j(B=>({...B,[l]:z==="checkbox"?A:M}))},{apiBaseUrl:b,loading:U,error:g}=I(),i=async()=>{if(!U){if(g){S.error("API config error: "+g);return}h(!0);try{let s,l;if(s=await w(`${b}/v2/api/users/${c.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),!s.ok)throw new Error("Failed to save user");l=await s.json(),S.success("User updated"),o(l),a()}catch(s){S.error(s.message||"Error saving user")}finally{h(!1)}}},n=E.filter((s,l)=>l%2===0),C=E.filter((s,l)=>l%2===1);return e.jsxs(v,{show:r,onHide:a,size:"lg",centered:!0,contentClassName:"user-modal-responsive",children:[e.jsx(v.Header,{closeButton:!0,children:e.jsx(v.Title,{children:"User Details"})}),e.jsx(v.Body,{style:{maxHeight:"60vh",overflowY:"auto",minHeight:200},children:e.jsx(d,{children:e.jsxs(N,{children:[e.jsx(f,{xs:12,lg:6,children:n.map(({key:s,label:l})=>e.jsxs(d.Group,{className:"mb-3",as:N,children:[e.jsx(d.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:l}),e.jsx(f,{sm:8,xs:7,children:s==="active"?e.jsx(d.Check,{type:"checkbox",name:s,checked:!!c[s],onChange:x,disabled:u}):e.jsx(d.Control,{name:s,value:c[s]??"",onChange:x,disabled:u||s==="id",readOnly:s==="id",type:typeof c[s]=="number"?"number":"text"})})]},s))}),e.jsx(f,{xs:12,lg:6,children:C.map(({key:s,label:l})=>e.jsxs(d.Group,{className:"mb-3",as:N,children:[e.jsx(d.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:l}),e.jsx(f,{sm:8,xs:7,children:s==="active"?e.jsx(d.Check,{type:"checkbox",name:s,checked:!!c[s],onChange:x,disabled:u}):e.jsx(d.Control,{name:s,value:c[s]??"",onChange:x,disabled:u||s==="id",readOnly:s==="id",type:typeof c[s]=="number"?"number":"text"})})]},s))})]})})}),e.jsxs(v.Footer,{children:[e.jsx(y,{variant:"primary",onClick:i,disabled:u,children:u?e.jsx(D,{size:"sm",animation:"border"}):"Save"}),e.jsx(y,{variant:"secondary",onClick:a,disabled:u,children:"Cancel"})]})]})}const G=()=>{var g;const{user:r,authenticatedFetch:a}=L(),[t,o]=m.useState([]),[p,c]=m.useState(!0),[j,u]=m.useState({key:"id",direction:"asc"}),[h,w]=m.useState({userName:""});m.useEffect(()=>{c(!0),a("https://dailyapisimple-gjchg7exhrcxf5cc.centralus-01.azurewebsites.net/v2/api/users").then(n=>{if(!n.ok)throw new Error("Failed to fetch users");return n.json()}).then(n=>o(n)).catch(n=>S.error(n.message||"Error loading users")).finally(()=>c(!1))},[a]);const x=m.useMemo(()=>t.filter(i=>!h.userName||(i.userName||"").toLowerCase().includes(h.userName.toLowerCase())),[t,h]),b=m.useMemo(()=>[...x].sort((i,n)=>R(i,n,j.key,j.direction)),[x,j]),U=i=>{o(n=>n.map(C=>C.id===i.id?i:C))};return!r||!((g=r.roles)!=null&&g.includes("admin"))?e.jsx("div",{className:"mt-4 text-danger",children:"Access denied."}):e.jsxs("div",{className:"container mt-4",children:[e.jsx("h2",{className:"mb-3",children:"Users"}),e.jsx(d,{className:"mb-3",children:e.jsx(N,{className:"g-2",children:e.jsx(f,{xs:12,sm:6,md:4,lg:3,xl:2,children:e.jsx(d.Control,{size:"sm",placeholder:"Filter by User Name",value:h.userName,onChange:i=>w(n=>({...n,userName:i.target.value}))})})})}),p?e.jsx("div",{className:"text-center my-5",children:e.jsx(D,{animation:"border"})}):e.jsx(N,{className:"g-2",children:b.map(i=>e.jsx(f,{xs:12,sm:6,md:4,lg:3,xl:2,xxl:2,children:e.jsx(W,{user:i,onSave:U})},i.id))}),b.length===0&&!p&&e.jsx("div",{children:"No users found."})]})};export{G as default};
