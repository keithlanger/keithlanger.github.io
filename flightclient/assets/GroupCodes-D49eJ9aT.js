import{j as e,F as j,R as w,a as I,S as P,P as n,b as D,B as F,M as v}from"./bootstrap-9hNhFV_4.js";import{r as i}from"./vendor-D-ycbrtU.js";import{u as A,y as G}from"./index-DeSyhpwb.js";import"./router-Cwzx9i8E.js";const M=[{key:"groupId",label:"Group ID"},{key:"groupCode",label:"Group Code"},{key:"line",label:"Line"},{key:"lineCode",label:"Line Code"},{key:"opsCode",label:"Ops Code"},{key:"inlineLogo",label:"Inline Logo"},{key:"bulletLogo",label:"Bullet Logo"},{key:"backLogo",label:"Back Logo"},{key:"gateLogo",label:"Gate Logo"},{key:"firstNumber",label:"First Number"},{key:"lastNumber",label:"Last Number"},{key:"defaultLanguage",label:"Default Language"},{key:"siteId",label:"Site ID"}],O=({group:c,onSave:m})=>{const[g,h]=i.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mb-3 shadow-sm group-card-mini text-truncate",style:{cursor:"pointer",minWidth:0,maxWidth:260,width:"100%"},onClick:()=>h(!0),children:e.jsxs(D.Body,{className:"p-2 d-flex flex-column align-items-start justify-content-between",children:[e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"ID:"})," ",c.groupId]}),e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"Code:"})," ",c.groupCode]}),e.jsxs("div",{className:"mb-2 text-truncate",style:{width:"100%",fontSize:"0.85em",color:"#888"},children:[e.jsx("strong",{children:"Line:"})," ",c.line]}),e.jsx(F,{variant:"outline-primary",size:"sm",className:"align-self-end",onClick:f=>{f.stopPropagation(),h(!0)},children:"Details"})]})}),e.jsx(R,{show:g,onHide:()=>h(!1),group:c,onSave:m})]})};function R({show:c,onHide:m,group:g,onSave:h,mode:f="edit"}){const[C,k]=i.useState(g||{}),[y,l]=i.useState(!1),{authenticatedFetch:S}=A();i.useEffect(()=>{k(g||{})},[g,c]);const t=a=>{const{name:u,value:b,type:N,checked:r}=a.target;k(L=>({...L,[u]:N==="checkbox"?r:b}))},d=async()=>{l(!0);try{const a="https://dailyapisimple-gjchg7exhrcxf5cc.centralus-01.azurewebsites.net";let u,b;if(u=await S(`${a}/api/GroupCodes`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)}),!u.ok)throw new Error("Failed to save group code");b=await u.json(),G.success("Group code updated"),h(b),m()}catch(a){G.error(a.message||"Error saving group code")}finally{l(!1)}};return e.jsxs(v,{show:c,onHide:m,size:"lg",centered:!0,contentClassName:"group-modal-responsive",children:[e.jsx(v.Header,{closeButton:!0,children:e.jsx(v.Title,{children:"Group Code Details"})}),e.jsx(v.Body,{style:{maxHeight:"60vh",overflowY:"auto",minHeight:200},children:e.jsx(j,{children:M.map(({key:a,label:u})=>e.jsxs(j.Group,{className:"mb-3",as:w,children:[e.jsx(j.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:u}),e.jsx(I,{sm:8,xs:7,children:e.jsx(j.Control,{name:a,value:C[a]??"",onChange:t,disabled:y||a==="groupId",readOnly:a==="groupId",type:typeof C[a]=="number"?"number":"text"})})]},a))})}),e.jsxs(v.Footer,{children:[e.jsx(F,{variant:"primary",onClick:d,disabled:y,children:y?e.jsx(P,{size:"sm",animation:"border"}):"Save"}),e.jsx(F,{variant:"secondary",onClick:m,disabled:y,children:"Cancel"})]})]})}const $=()=>{var E;const{user:c,authenticatedFetch:m}=A(),[g,h]=i.useState([]),[f,C]=i.useState(!0),[k,y]=i.useState({key:"groupId",direction:"asc"}),[l,S]=i.useState({line:"",groupCode:""}),[t,d]=i.useState(1),a=12,[u,b]=i.useState(0);i.useEffect(()=>{C(!0);const s="https://dailyapisimple-gjchg7exhrcxf5cc.centralus-01.azurewebsites.net",o=new URLSearchParams;o.append("skip",(t-1)*a),o.append("top",a),l.line&&o.append("line",l.line),l.groupCode&&o.append("groupCode",l.groupCode),m(`${s}/api/GroupCodes?${o.toString()}`).then(async x=>{if(!x.ok)throw new Error("Failed to fetch group codes");const z=x.headers.get("x-total-items"),p=await x.json();h(Array.isArray(p)?p:p.data||[]),b(z?parseInt(z,10):Array.isArray(p)?p.length:p.totalCount||(p.data?p.data.length:0))}).catch(x=>G.error(x.message||"Error loading group codes")).finally(()=>C(!1))},[m,t,a,l.line,l.groupCode]);const N=g,r=Math.max(1,Math.ceil(u/a)),L=N;i.useEffect(()=>{d(1)},[l,k]);const B=s=>{h(o=>o.map(x=>x.groupId===s.groupId?s:x))};return!c||!((E=c.roles)!=null&&E.includes("admin"))?e.jsx("div",{className:"mt-4 text-danger",children:"Access denied."}):e.jsxs("div",{className:"container mt-4",children:[e.jsx("h2",{className:"mb-3",children:"Group Codes"}),e.jsx(j,{className:"mb-3",children:e.jsxs(w,{className:"g-2",children:[e.jsx(I,{xs:12,sm:6,md:4,lg:3,xl:2,children:e.jsx(j.Control,{size:"sm",placeholder:"Filter by Group Code",value:l.groupCode,onChange:s=>S(o=>({...o,groupCode:s.target.value}))})}),e.jsx(I,{xs:12,sm:6,md:4,lg:3,xl:2,children:e.jsx(j.Control,{size:"sm",placeholder:"Filter by Line",value:l.line,onChange:s=>S(o=>({...o,line:s.target.value}))})})]})}),f?e.jsx("div",{className:"text-center my-5",children:e.jsx(P,{animation:"border"})}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"g-2",children:L.map(s=>e.jsx(I,{xs:12,sm:6,md:4,lg:3,xl:2,xxl:2,children:e.jsx(O,{group:s,onSave:B})},s.groupId))}),r>1&&e.jsx("div",{className:"d-flex justify-content-center mt-3",children:e.jsxs(n,{children:[e.jsx(n.First,{onClick:()=>d(1),disabled:t===1}),e.jsx(n.Prev,{onClick:()=>d(s=>Math.max(1,s-1)),disabled:t===1}),e.jsx(n.Item,{active:t===1,onClick:()=>d(1),children:1}),t>4&&e.jsx(n.Ellipsis,{disabled:!0}),Array.from({length:2},(s,o)=>t-2+o).filter(s=>s>1&&s<t).map(s=>e.jsx(n.Item,{onClick:()=>d(s),children:s},s)),t!==1&&t!==r&&e.jsx(n.Item,{active:!0,children:t}),Array.from({length:2},(s,o)=>t+1+o).filter(s=>s<r&&s>t).map(s=>e.jsx(n.Item,{onClick:()=>d(s),children:s},s)),t<r-3&&e.jsx(n.Ellipsis,{disabled:!0}),r>1&&e.jsx(n.Item,{active:t===r,onClick:()=>d(r),children:r}),e.jsx(n.Next,{onClick:()=>d(s=>Math.min(r,s+1)),disabled:t===r}),e.jsx(n.Last,{onClick:()=>d(r),disabled:t===r})]})})]}),N.length===0&&!f&&e.jsx("div",{children:"No group codes found."})]})};export{$ as default};
//# sourceMappingURL=GroupCodes-D49eJ9aT.js.map
