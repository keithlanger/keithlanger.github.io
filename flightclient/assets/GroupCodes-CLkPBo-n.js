import{j as e,B as z,S as O,R as A,a as w,P as h,F as b,M as S,b as M}from"./bootstrap-DDHsVi9e.js";import{r as o}from"./vendor-D-ycbrtU.js";import{u as B,y as P}from"./index-BtL-Li30.js";import"./router-Cwzx9i8E.js";const D=[{key:"id",label:"ID"},{key:"lineCode",label:"Line Code"},{key:"line",label:"Line"},{key:"firstNumber",label:"First Number"},{key:"lastNumber",label:"Last Number"},{key:"opsCode",label:"Ops Code"},{key:"inlineLogo",label:"Inline Logo"},{key:"bulletLogo",label:"Bullet Logo"},{key:"backLogo",label:"Back Logo"},{key:"gateLogo",label:"Gate Logo"},{key:"groupCode",label:"Group Code"},{key:"defaultLanguage",label:"Default Language"},{key:"siteId",label:"Site ID"}],R=({group:x,onSave:j})=>{const[p,g]=o.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"mb-3 shadow-sm group-card-mini text-truncate",style:{cursor:"pointer",minWidth:0,maxWidth:260,width:"100%"},onClick:()=>g(!0),children:e.jsxs(M.Body,{className:"p-2 d-flex flex-column align-items-start justify-content-between",children:[e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"ID:"})," ",x.id]}),e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"Code:"})," ",x.groupCode]}),e.jsxs("div",{className:"mb-2 text-truncate",style:{width:"100%",fontSize:"0.85em",color:"#888"},children:[e.jsx("strong",{children:"Line:"})," ",x.line]}),e.jsx(z,{variant:"outline-primary",size:"sm",className:"align-self-end",onClick:u=>{u.stopPropagation(),g(!0)},children:"Details"})]})}),e.jsx(T,{show:p,onHide:()=>g(!1),group:x,onSave:j})]})};function T({show:x,onHide:j,group:p,onSave:g,mode:u="edit"}){const[t,v]=o.useState(p||{}),[C,i]=o.useState(!1),[d,m]=o.useState(""),{authenticatedFetch:L}=B();o.useEffect(()=>{v(u==="add"?{id:0,siteId:1,firstNumber:1,lastNumber:9999,defaultLanguage:"en"}:p||{}),m("")},[p,x,u]);const I=a=>{const{name:r,value:f,type:s,checked:n}=a.target;v(c=>({...c,[r]:s==="checkbox"?n:f})),m("")},F=async()=>{if(!t.lineCode||!t.line||!t.groupCode||t.firstNumber===void 0||t.firstNumber===""||t.lastNumber===void 0||t.lastNumber===""){m("Line Code, Line, Group Code, First Number, and Last Number are required.");return}const a=Number(t.firstNumber),r=Number(t.lastNumber);if(isNaN(a)||isNaN(r)||a<1||a>9999||r<1||r>9999){m("First Number and Last Number must be numbers between 1 and 9999.");return}if(a>r){m("First Number must be less than or equal to Last Number.");return}i(!0);try{const f="https://dailyapisimple-gjchg7exhrcxf5cc.centralus-01.azurewebsites.net";let s,n;if(u==="add"){if(s=await L(`${f}/api/GroupCodes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),!s.ok)throw new Error("Failed to create group code");n=await s.json(),P.success("Group code created")}else{if(s=await L(`${f}/api/GroupCodes/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),!s.ok)throw new Error("Failed to save group code");n=await s.json(),P.success("Group code updated")}g(n,u),j()}catch(f){P.error(f.message||(u==="add"?"Error creating group code":"Error saving group code"))}finally{i(!1)}},G=Math.ceil(D.length/2),E=D.slice(0,G),k=D.slice(G),l=a=>{if(!d)return!1;if(a==="lineCode"&&(!t.lineCode||t.lineCode==="")||a==="line"&&(!t.line||t.line==="")||a==="groupCode"&&(!t.groupCode||t.groupCode===""))return!0;if(a==="firstNumber"){const r=Number(t.firstNumber);return t.firstNumber===void 0||t.firstNumber===""||isNaN(r)||r<1||r>9999||t.lastNumber!==void 0&&t.lastNumber!==""&&r>Number(t.lastNumber)}if(a==="lastNumber"){const r=Number(t.lastNumber);return t.lastNumber===void 0||t.lastNumber===""||isNaN(r)||r<1||r>9999||t.firstNumber!==void 0&&t.firstNumber!==""&&Number(t.firstNumber)>r}return!1};return e.jsxs(S,{show:x,onHide:j,size:"lg",centered:!0,contentClassName:"group-modal-responsive",children:[e.jsx(S.Header,{closeButton:!0,children:e.jsx(S.Title,{children:u==="add"?"Add Group Code":"Group Code Details"})}),e.jsxs(S.Body,{style:{maxHeight:"60vh",overflowY:"auto",minHeight:200},children:[d&&e.jsx("div",{className:"alert alert-danger py-2 mb-3",role:"alert",style:{fontSize:"0.95em"},children:d}),e.jsx(b,{children:e.jsxs(A,{children:[e.jsx(w,{xs:12,lg:6,children:E.map(({key:a,label:r})=>e.jsxs(b.Group,{className:"mb-3",as:A,children:[e.jsx(b.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:r}),e.jsx(w,{sm:8,xs:7,children:e.jsx(b.Control,{name:a,value:t[a]??"",onChange:I,disabled:C||a==="id"||a==="siteId",readOnly:a==="id"||a==="siteId",type:typeof t[a]=="number"?"number":"text",tabIndex:a==="siteId"?-1:void 0,isInvalid:l(a)})})]},a))}),e.jsx(w,{xs:12,lg:6,children:k.map(({key:a,label:r})=>e.jsxs(b.Group,{className:"mb-3",as:A,children:[e.jsx(b.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:r}),e.jsx(w,{sm:8,xs:7,children:e.jsx(b.Control,{name:a,value:t[a]??"",onChange:I,disabled:C||a==="id"||a==="siteId",readOnly:a==="id"||a==="siteId",type:typeof t[a]=="number"?"number":"text",tabIndex:a==="siteId"?-1:void 0,isInvalid:l(a)})})]},a))})]})})]}),e.jsxs(S.Footer,{children:[e.jsx(z,{variant:"primary",onClick:F,disabled:C,children:C?e.jsx(O,{size:"sm",animation:"border"}):u==="add"?"Create":"Save"}),e.jsx(z,{variant:"secondary",onClick:j,disabled:C,children:"Cancel"})]})]})}const _=()=>{var f;const{user:x,authenticatedFetch:j}=B(),[p,g]=o.useState([]),[u,t]=o.useState(!0),[v,C]=o.useState({key:"id",direction:"asc"}),[i,d]=o.useState(1),[m,L]=o.useState(20),[I,F]=o.useState(0),[G,E]=o.useState(!1);o.useEffect(()=>{t(!0);const s="https://dailyapisimple-gjchg7exhrcxf5cc.centralus-01.azurewebsites.net",n=new URLSearchParams;n.append("skip",(i-1)*m),n.append("top",m),j(`${s}/api/GroupCodes?${n.toString()}`).then(async c=>{if(!c.ok)throw new Error("Failed to fetch group codes");const y=c.headers.get("x-total-items"),N=await c.json();g(Array.isArray(N)?N:N.data||[]),F(y?parseInt(y,10):Array.isArray(N)?N.length:N.totalCount||(N.data?N.data.length:0))}).catch(c=>P.error(c.message||"Error loading group codes")).finally(()=>t(!1))},[j,i,m]);const k=p,l=Math.max(1,Math.ceil((I||p.length)/m)),a=k;o.useEffect(()=>{d(1)},[v,m]);const r=(s,n)=>{n==="add"?(g(c=>[s,...c]),F(c=>c+1)):g(c=>c.map(y=>y.id===s.id?s:y))};return!x||!((f=x.roles)!=null&&f.includes("admin"))?e.jsx("div",{className:"mt-4 text-danger",children:"Access denied."}):e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h2",{className:"mb-0",children:"Group Codes"}),e.jsx(z,{variant:"success",onClick:()=>E(!0),children:"+ Add Group Code"})]}),e.jsx(T,{show:G,onHide:()=>E(!1),mode:"add",onSave:r}),u?e.jsx("div",{className:"text-center my-5",children:e.jsx(O,{animation:"border"})}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"g-2",children:a.map(s=>e.jsx(w,{xs:12,sm:6,md:4,lg:3,xl:2,xxl:2,children:e.jsx(R,{group:s,onSave:r})},s.id))}),p.length>0&&e.jsxs("div",{className:"d-flex justify-content-center align-items-center gap-3 mt-3 flex-wrap",children:[e.jsxs(h,{className:"mb-0",children:[e.jsx(h.First,{onClick:()=>d(1),disabled:i===1}),e.jsx(h.Prev,{onClick:()=>d(s=>Math.max(1,s-1)),disabled:i===1}),e.jsx(h.Item,{active:i===1,onClick:()=>d(1),children:1}),i>4&&e.jsx(h.Ellipsis,{disabled:!0}),Array.from({length:2},(s,n)=>i-2+n).filter(s=>s>1&&s<i).map(s=>e.jsx(h.Item,{onClick:()=>d(s),children:s},s)),i!==1&&i!==l&&e.jsx(h.Item,{active:!0,children:i}),Array.from({length:2},(s,n)=>i+1+n).filter(s=>s<l&&s>i).map(s=>e.jsx(h.Item,{onClick:()=>d(s),children:s},s)),i<l-3&&e.jsx(h.Ellipsis,{disabled:!0}),l>1&&e.jsx(h.Item,{active:i===l,onClick:()=>d(l),children:l}),e.jsx(h.Next,{onClick:()=>d(s=>Math.min(l,s+1)),disabled:i===l}),e.jsx(h.Last,{onClick:()=>d(l),disabled:i===l})]}),e.jsxs(b.Group,{controlId:"pageSizeSelect",className:"mb-0",children:[e.jsx(b.Label,{visuallyHidden:!0,children:"Items per page"}),e.jsx(b.Select,{size:"sm",value:m,onChange:s=>L(Number(s.target.value)),children:[10,20,30,50,100].map(s=>e.jsxs("option",{value:s,children:[s," per page"]},s))})]})]})]}),k.length===0&&!u&&e.jsx("div",{children:"No group codes found."})]})};export{_ as default};
//# sourceMappingURL=GroupCodes-CLkPBo-n.js.map
