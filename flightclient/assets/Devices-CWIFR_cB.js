import{j as e,B as A,T as W,F as i,S as L,R as b,a as p,M as N,b as T}from"./bootstrap-loZ_3mSD.js";import{r as o}from"./vendor-CAgi6j6b.js";import{u as O,y as E}from"./index-tXQiiCGC.js";import"./router-BUXXEe8L.js";const j=[{key:"id",label:"ID"},{key:"name",label:"Name"},{key:"siteId",label:"Site ID"},{key:"ipAddress",label:"IP Address"},{key:"uid",label:"UID"},{key:"type",label:"Type"},{key:"manufacturer",label:"Manufacturer"},{key:"model",label:"Model"},{key:"operatingSystem",label:"Operating System"},{key:"active",label:"Active"},{key:"deviceConfigurationId",label:"Device Config ID"},{key:"availablePorts",label:"Available Ports"},{key:"userAgentId",label:"User Agent ID"}];function M(a,c,r,m){return a[r]==null&&c[r]==null?0:a[r]==null?1:c[r]==null?-1:typeof a[r]=="string"?m==="asc"?a[r].localeCompare(c[r]):c[r].localeCompare(a[r]):m==="asc"?a[r]-c[r]:c[r]-a[r]}const P=({device:a,onSave:c})=>{const[r,m]=o.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mb-3 shadow-sm device-card-mini text-truncate",style:{cursor:"pointer",minWidth:0,maxWidth:260,width:"100%"},onClick:()=>m(!0),children:e.jsxs(T.Body,{className:"p-2 d-flex flex-column align-items-start justify-content-between",children:[e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"ID:"})," ",a.id]}),e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"Name:"})," ",a.name]}),e.jsxs("div",{className:"mb-2 text-truncate",style:{width:"100%",fontSize:"0.85em",color:"#888"},children:[e.jsx("strong",{children:"UID:"})," ",a.uid]}),e.jsx(A,{variant:"outline-primary",size:"sm",className:"align-self-end",onClick:u=>{u.stopPropagation(),m(!0)},children:"Details"})]})}),e.jsx(U,{show:r,onHide:()=>m(!1),device:a,onSave:c})]})};function U({show:a,onHide:c,device:r,onSave:m,mode:u="edit"}){var S;const f=(S=r==null?void 0:r.links)==null?void 0:S.userAgent,[d,w]=o.useState(()=>u==="add"?{...r,id:0}:r||{}),[h,D]=o.useState(!1),{authenticatedFetch:g}=O();o.useEffect(()=>{w(u==="add"?{...r,id:0}:r||{})},[r,a,u]);const v=s=>{const{name:l,value:t,type:n,checked:x}=s.target;w(C=>({...C,[l]:n==="checkbox"?x:t}))},I=async()=>{D(!0);try{const s="https://dailyapisimple-gjchg7exhrcxf5cc.centralus-01.azurewebsites.net";let l,t;if(u==="add"){if(l=await g(`${s}/api/devices`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}),!l.ok)throw new Error("Failed to add device");t=await l.json(),E.success("Device added")}else{if(l=await g(`${s}/api/devices/${d.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}),!l.ok)throw new Error("Failed to save device");t=await l.json(),E.success("Device updated")}m(t),c()}catch(s){E.error(s.message||(u==="add"?"Error adding device":"Error saving device"))}finally{D(!1)}},y=f?j.filter(s=>s.key!=="userAgentId"):j,z=y.filter((s,l)=>l%2===0),F=y.filter((s,l)=>l%2===1);return e.jsxs(N,{show:a,onHide:c,size:"lg",centered:!0,contentClassName:"device-modal-responsive",children:[e.jsx(N.Header,{closeButton:!0,children:e.jsx(N.Title,{children:u==="add"?"Add New Device":"Device Details"})}),e.jsxs(N.Body,{style:{maxHeight:"60vh",overflowY:"auto",minHeight:200},children:[e.jsx(i,{children:e.jsxs(b,{children:[e.jsx(p,{xs:12,lg:6,children:z.map(({key:s,label:l})=>e.jsxs(i.Group,{className:"mb-3",as:b,children:[e.jsx(i.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:l}),e.jsx(p,{sm:8,xs:7,children:s==="active"?e.jsx(i.Check,{type:"checkbox",name:s,checked:!!d[s],onChange:v,disabled:h}):e.jsx(i.Control,{name:s,value:d[s]??"",onChange:v,disabled:h||s==="id"||s==="userAgentId",readOnly:s==="id"||s==="userAgentId",type:typeof d[s]=="number"?"number":"text"})})]},s))}),e.jsx(p,{xs:12,lg:6,children:F.map(({key:s,label:l})=>e.jsxs(i.Group,{className:"mb-3",as:b,children:[e.jsx(i.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:l}),e.jsx(p,{sm:8,xs:7,children:s==="active"?e.jsx(i.Check,{type:"checkbox",name:s,checked:!!d[s],onChange:v,disabled:h}):e.jsx(i.Control,{name:s,value:d[s]??"",onChange:v,disabled:h||s==="id"||s==="userAgentId",readOnly:s==="id"||s==="userAgentId",type:typeof d[s]=="number"?"number":"text"})})]},s))})]})}),f&&e.jsxs("fieldset",{className:"border rounded p-3 mb-3 bg-light",children:[e.jsxs("legend",{className:"w-auto mb-0 d-flex align-items-center",style:{fontSize:"1rem",fontWeight:600},children:[e.jsx("span",{role:"img","aria-label":"User Agent",style:{marginRight:6},children:"🧑‍💻"})," User Agent Information"]}),e.jsxs("div",{className:"d-flex flex-column gap-3",children:[e.jsxs(i.Group,{className:"w-100 mb-0",as:b,children:[e.jsx(i.Label,{column:!0,sm:5,xs:5,style:{fontWeight:500},children:"ID"}),e.jsx(p,{sm:7,xs:7,children:e.jsx(i.Control,{value:d.userAgentId??"",readOnly:!0,disabled:!0,style:{backgroundColor:"#e9ecef",color:"#495057"}})})]}),f.userAgentText&&e.jsxs(i.Group,{className:"w-100 mb-0",as:b,children:[e.jsx(i.Label,{column:!0,sm:5,xs:5,style:{fontWeight:500},children:"Agent"}),e.jsx(p,{sm:7,xs:7,children:e.jsx(i.Control,{value:f.userAgentText,readOnly:!0,style:{backgroundColor:"#e9ecef",color:"#495057",fontWeight:500}})})]}),f.description&&e.jsxs(i.Group,{className:"w-100 mb-0",as:b,children:[e.jsx(i.Label,{column:!0,sm:5,xs:5,style:{fontWeight:500},children:"Description"}),e.jsx(p,{sm:7,xs:7,children:e.jsx(i.Control,{value:f.description,readOnly:!0,style:{backgroundColor:"#e9ecef",color:"#495057"}})})]})]})]})]}),e.jsxs(N.Footer,{children:[e.jsx(A,{variant:"primary",onClick:I,disabled:h,children:h?e.jsx(L,{size:"sm",animation:"border"}):u==="add"?"Add":"Save"}),e.jsx(A,{variant:"secondary",onClick:c,disabled:h,children:"Cancel"})]})]})}const $=()=>{var s,l;const{user:a,authenticatedFetch:c}=O(),[r,m]=o.useState([]),[u,f]=o.useState(!0),[d,w]=o.useState(j.reduce((t,n)=>({...t,[n.key]:""}),{})),[h,D]=o.useState(!1),[g,v]=o.useState({key:"id",direction:"asc"});o.useEffect(()=>{f(!0),c("https://dailyapisimple-gjchg7exhrcxf5cc.centralus-01.azurewebsites.net/api/devices").then(n=>{if(!n.ok)throw new Error("Failed to fetch devices");return n.json()}).then(n=>m(n)).catch(n=>E.error(n.message||"Error loading devices")).finally(()=>f(!1))},[c]);const I=o.useMemo(()=>r.filter(t=>j.every(({key:n})=>{var x;return d[n]?(x=t[n])==null?void 0:x.toString().toLowerCase().includes(d[n].toLowerCase()):!0})),[r,d]),y=o.useMemo(()=>[...I].sort((t,n)=>M(t,n,g.key,g.direction)),[I,g]),[z,F]=o.useState(!1),S=t=>{m(n=>n.findIndex(C=>C.id===t.id)!==-1?n.map(C=>C.id===t.id?t:C):[t,...n])};return!a||!((s=a.roles)!=null&&s.includes("admin")||(l=a.roles)!=null&&l.includes("device"))?e.jsx("div",{className:"mt-4 text-danger",children:"Access denied."}):e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("h2",{className:"mb-0",children:"Devices"}),e.jsx(A,{variant:"success",size:"sm",onClick:()=>F(!0),children:"+ Add new device"})]}),e.jsx(U,{show:z,onHide:()=>F(!1),device:{},onSave:S,mode:"add"}),e.jsx(W,{bordered:!0,size:"sm",className:"mb-4",children:e.jsxs("thead",{children:[e.jsx("tr",{children:(h?j:j.slice(0,3)).map(({key:t,label:n})=>e.jsxs("th",{style:{cursor:"pointer"},onClick:()=>v(x=>({key:t,direction:x.key===t&&x.direction==="asc"?"desc":"asc"})),children:[n," ",g.key===t?g.direction==="asc"?"▲":"▼":null]},t))}),e.jsx("tr",{children:(h?j:j.slice(0,3)).map(({key:t})=>e.jsx("th",{children:e.jsx(i.Control,{size:"sm",placeholder:"Filter",value:d[t],onChange:n=>w(x=>({...x,[t]:n.target.value}))})},t))}),e.jsx("tr",{children:e.jsx("th",{colSpan:j.length,className:"p-1 text-end",children:e.jsx(A,{variant:"outline-secondary",size:"sm",onClick:()=>D(t=>!t),"aria-expanded":h,children:h?"Hide advanced filters":"Show advanced filters"})})})]})}),u?e.jsx("div",{className:"text-center my-5",children:e.jsx(L,{animation:"border"})}):e.jsx(b,{className:"g-2",children:y.map(t=>e.jsx(p,{xs:12,sm:6,md:4,lg:3,xl:2,xxl:2,children:e.jsx(P,{device:t,onSave:S})},t.id))}),y.length===0&&!u&&e.jsx("div",{children:"No devices found."})]})};export{$ as default};
