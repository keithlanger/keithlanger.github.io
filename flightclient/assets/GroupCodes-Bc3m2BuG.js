import{j as e,F as o,R as k,a as y,S as M,P as c,b as A,B as E,M as N}from"./bootstrap-9hNhFV_4.js";import{r as i}from"./vendor-D-ycbrtU.js";import{u as O,y as z}from"./index-Dq4xb-dF.js";import"./router-Cwzx9i8E.js";const B=[{key:"id",label:"ID"},{key:"groupCode",label:"Group Code"},{key:"line",label:"Line"},{key:"lineCode",label:"Line Code"},{key:"opsCode",label:"Ops Code"},{key:"inlineLogo",label:"Inline Logo"},{key:"bulletLogo",label:"Bullet Logo"},{key:"backLogo",label:"Back Logo"},{key:"gateLogo",label:"Gate Logo"},{key:"firstNumber",label:"First Number"},{key:"lastNumber",label:"Last Number"},{key:"defaultLanguage",label:"Default Language"},{key:"siteId",label:"Site ID"}],_=({group:u,onSave:x})=>{const[C,g]=i.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"mb-3 shadow-sm group-card-mini text-truncate",style:{cursor:"pointer",minWidth:0,maxWidth:260,width:"100%"},onClick:()=>g(!0),children:e.jsxs(A.Body,{className:"p-2 d-flex flex-column align-items-start justify-content-between",children:[e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"ID:"})," ",u.id]}),e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"Code:"})," ",u.groupCode]}),e.jsxs("div",{className:"mb-2 text-truncate",style:{width:"100%",fontSize:"0.85em",color:"#888"},children:[e.jsx("strong",{children:"Line:"})," ",u.line]}),e.jsx(E,{variant:"outline-primary",size:"sm",className:"align-self-end",onClick:S=>{S.stopPropagation(),g(!0)},children:"Details"})]})}),e.jsx(R,{show:C,onHide:()=>g(!1),group:u,onSave:x})]})};function R({show:u,onHide:x,group:C,onSave:g,mode:S="edit"}){const[h,L]=i.useState(C||{}),[v,d]=i.useState(!1),{authenticatedFetch:w}=O();i.useEffect(()=>{L(C||{})},[C,u]);const a=t=>{const{name:l,value:f,type:r,checked:G}=t.target;L(I=>({...I,[l]:r==="checkbox"?G:f}))},m=async()=>{d(!0);try{const t="https://dailyapisimple-gjchg7exhrcxf5cc.centralus-01.azurewebsites.net";let l,f;if(l=await w(`${t}/api/GroupCodes/${h.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}),!l.ok)throw new Error("Failed to save group code");f=await l.json(),z.success("Group code updated"),g(f),x()}catch(t){z.error(t.message||"Error saving group code")}finally{d(!1)}},p=B.filter((t,l)=>l%2===0),F=B.filter((t,l)=>l%2===1);return e.jsxs(N,{show:u,onHide:x,size:"lg",centered:!0,contentClassName:"group-modal-responsive",children:[e.jsx(N.Header,{closeButton:!0,children:e.jsx(N.Title,{children:"Group Code Details"})}),e.jsx(N.Body,{style:{maxHeight:"60vh",overflowY:"auto",minHeight:200},children:e.jsx(o,{children:e.jsxs(k,{children:[e.jsx(y,{xs:12,lg:6,children:p.map(({key:t,label:l})=>e.jsxs(o.Group,{className:"mb-3",as:k,children:[e.jsx(o.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:l}),e.jsx(y,{sm:8,xs:7,children:e.jsx(o.Control,{name:t,value:h[t]??"",onChange:a,disabled:v||t==="id",readOnly:t==="id",type:typeof h[t]=="number"?"number":"text"})})]},t))}),e.jsx(y,{xs:12,lg:6,children:F.map(({key:t,label:l})=>e.jsxs(o.Group,{className:"mb-3",as:k,children:[e.jsx(o.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:l}),e.jsx(y,{sm:8,xs:7,children:e.jsx(o.Control,{name:t,value:h[t]??"",onChange:a,disabled:v||t==="id",readOnly:t==="id",type:typeof h[t]=="number"?"number":"text"})})]},t))})]})})}),e.jsxs(N.Footer,{children:[e.jsx(E,{variant:"primary",onClick:m,disabled:v,children:v?e.jsx(M,{size:"sm",animation:"border"}):"Save"}),e.jsx(E,{variant:"secondary",onClick:x,disabled:v,children:"Cancel"})]})]})}const H=()=>{var P;const{user:u,authenticatedFetch:x}=O(),[C,g]=i.useState([]),[S,h]=i.useState(!0),[L,v]=i.useState({key:"id",direction:"asc"}),[d,w]=i.useState({line:"",groupCode:""}),[a,m]=i.useState(1),[p,F]=i.useState(20),[t,l]=i.useState(0);i.useEffect(()=>{h(!0);const s="https://dailyapisimple-gjchg7exhrcxf5cc.centralus-01.azurewebsites.net",n=new URLSearchParams;n.append("skip",(a-1)*p),n.append("top",p),d.line&&n.append("line",d.line),d.groupCode&&n.append("groupCode",d.groupCode),x(`${s}/api/GroupCodes?${n.toString()}`).then(async j=>{if(!j.ok)throw new Error("Failed to fetch group codes");const D=j.headers.get("x-total-items"),b=await j.json();g(Array.isArray(b)?b:b.data||[]),l(D?parseInt(D,10):Array.isArray(b)?b.length:b.totalCount||(b.data?b.data.length:0))}).catch(j=>z.error(j.message||"Error loading group codes")).finally(()=>h(!1))},[x,a,p,d.line,d.groupCode]);const f=C,r=Math.max(1,Math.ceil(t/p)),G=f;i.useEffect(()=>{m(1)},[d,L,p]);const I=s=>{g(n=>n.map(j=>j.id===s.id?s:j))};return!u||!((P=u.roles)!=null&&P.includes("admin"))?e.jsx("div",{className:"mt-4 text-danger",children:"Access denied."}):e.jsxs("div",{className:"container mt-4",children:[e.jsx("h2",{className:"mb-3",children:"Group Codes"}),e.jsx(o,{className:"mb-3",children:e.jsxs(k,{className:"g-2 align-items-end",children:[e.jsx(y,{xs:12,sm:6,md:4,lg:3,xl:2,children:e.jsx(o.Control,{size:"sm",placeholder:"Filter by Group Code",value:d.groupCode,onChange:s=>w(n=>({...n,groupCode:s.target.value}))})}),e.jsx(y,{xs:12,sm:6,md:4,lg:3,xl:2,children:e.jsx(o.Control,{size:"sm",placeholder:"Filter by Line",value:d.line,onChange:s=>w(n=>({...n,line:s.target.value}))})})]})}),S?e.jsx("div",{className:"text-center my-5",children:e.jsx(M,{animation:"border"})}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"g-2",children:G.map(s=>e.jsx(y,{xs:12,sm:6,md:4,lg:3,xl:2,xxl:2,children:e.jsx(_,{group:s,onSave:I})},s.id))}),r>1&&e.jsxs("div",{className:"d-flex justify-content-center align-items-center gap-3 mt-3 flex-wrap",children:[e.jsxs(c,{className:"mb-0",children:[e.jsx(c.First,{onClick:()=>m(1),disabled:a===1}),e.jsx(c.Prev,{onClick:()=>m(s=>Math.max(1,s-1)),disabled:a===1}),e.jsx(c.Item,{active:a===1,onClick:()=>m(1),children:1}),a>4&&e.jsx(c.Ellipsis,{disabled:!0}),Array.from({length:2},(s,n)=>a-2+n).filter(s=>s>1&&s<a).map(s=>e.jsx(c.Item,{onClick:()=>m(s),children:s},s)),a!==1&&a!==r&&e.jsx(c.Item,{active:!0,children:a}),Array.from({length:2},(s,n)=>a+1+n).filter(s=>s<r&&s>a).map(s=>e.jsx(c.Item,{onClick:()=>m(s),children:s},s)),a<r-3&&e.jsx(c.Ellipsis,{disabled:!0}),r>1&&e.jsx(c.Item,{active:a===r,onClick:()=>m(r),children:r}),e.jsx(c.Next,{onClick:()=>m(s=>Math.min(r,s+1)),disabled:a===r}),e.jsx(c.Last,{onClick:()=>m(r),disabled:a===r})]}),e.jsxs(o.Group,{controlId:"pageSizeSelect",className:"mb-0",children:[e.jsx(o.Label,{visuallyHidden:!0,children:"Items per page"}),e.jsx(o.Select,{size:"sm",value:p,onChange:s=>F(Number(s.target.value)),children:[10,20,30,50,100].map(s=>e.jsxs("option",{value:s,children:[s," per page"]},s))})]})]})]}),f.length===0&&!S&&e.jsx("div",{children:"No group codes found."})]})};export{H as default};
//# sourceMappingURL=GroupCodes-Bc3m2BuG.js.map
