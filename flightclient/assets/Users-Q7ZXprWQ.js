import{j as e,F as o,R as N,a as x,S as D,b as E,B as y,M as v}from"./bootstrap-loZ_3mSD.js";import{r as c}from"./vendor-CAgi6j6b.js";import{u as B,c as M,y as w}from"./index-BPZDyB2a.js";import"./router-BUXXEe8L.js";const L=[{key:"id",label:"ID"},{key:"userName",label:"User Name"},{key:"userDescription",label:"User Description"},{key:"name1",label:"Name 1"},{key:"name2",label:"Name 2"},{key:"active",label:"Active"}];function R(a,n,r,i){return a[r]==null&&n[r]==null?0:a[r]==null?1:n[r]==null?-1:typeof a[r]=="string"?i==="asc"?a[r].localeCompare(n[r]):n[r].localeCompare(a[r]):i==="asc"?a[r]-n[r]:n[r]-a[r]}const W=({user:a,onSave:n})=>{const[r,i]=c.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"mb-3 shadow-sm user-card-mini text-truncate",style:{cursor:"pointer",minWidth:0,maxWidth:260,width:"100%"},onClick:()=>i(!0),children:e.jsxs(E.Body,{className:"p-2 d-flex flex-column align-items-start justify-content-between",children:[e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"ID:"})," ",a.id]}),e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"Name:"})," ",a.userName]}),e.jsxs("div",{className:"mb-2 text-truncate",style:{width:"100%",fontSize:"0.85em",color:"#888"},children:[e.jsx("strong",{children:"Active:"})," ",a.active?"Yes":"No"]}),e.jsx(y,{variant:"outline-primary",size:"sm",className:"align-self-end",onClick:f=>{f.stopPropagation(),i(!0)},children:"Details"})]})}),e.jsx(O,{show:r,onHide:()=>i(!1),user:a,onSave:n})]})};function O({show:a,onHide:n,user:r,onSave:i,mode:f="edit"}){const[l,h]=c.useState(r||{}),[d,u]=c.useState(!1),{authenticatedFetch:F}=B();c.useEffect(()=>{h(r||{})},[r,a]);const m=s=>{const{name:t,value:S,type:z,checked:A}=s.target;h(I=>({...I,[t]:z==="checkbox"?A:S}))},{apiBaseUrl:g,loading:j,error:p}=M(),C=async()=>{if(!j){if(p){w.error("API config error: "+p);return}u(!0);try{let s,t;if(s=await F(`${g}/v2/api/users/${l.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),!s.ok)throw new Error("Failed to save user");t=await s.json(),w.success("User updated"),i(t),n()}catch(s){w.error(s.message||"Error saving user")}finally{u(!1)}}},U=L.filter((s,t)=>t%2===0),b=L.filter((s,t)=>t%2===1);return e.jsxs(v,{show:a,onHide:n,size:"lg",centered:!0,contentClassName:"user-modal-responsive",children:[e.jsx(v.Header,{closeButton:!0,children:e.jsx(v.Title,{children:"User Details"})}),e.jsx(v.Body,{style:{maxHeight:"60vh",overflowY:"auto",minHeight:200},children:e.jsx(o,{children:e.jsxs(N,{children:[e.jsx(x,{xs:12,lg:6,children:U.map(({key:s,label:t})=>e.jsxs(o.Group,{className:"mb-3",as:N,children:[e.jsx(o.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:t}),e.jsx(x,{sm:8,xs:7,children:s==="active"?e.jsx(o.Check,{type:"checkbox",name:s,checked:!!l[s],onChange:m,disabled:d}):e.jsx(o.Control,{name:s,value:l[s]??"",onChange:m,disabled:d||s==="id",readOnly:s==="id",type:typeof l[s]=="number"?"number":"text"})})]},s))}),e.jsx(x,{xs:12,lg:6,children:b.map(({key:s,label:t})=>e.jsxs(o.Group,{className:"mb-3",as:N,children:[e.jsx(o.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:t}),e.jsx(x,{sm:8,xs:7,children:s==="active"?e.jsx(o.Check,{type:"checkbox",name:s,checked:!!l[s],onChange:m,disabled:d}):e.jsx(o.Control,{name:s,value:l[s]??"",onChange:m,disabled:d||s==="id",readOnly:s==="id",type:typeof l[s]=="number"?"number":"text"})})]},s))})]})})}),e.jsxs(v.Footer,{children:[e.jsx(y,{variant:"primary",onClick:C,disabled:d,children:d?e.jsx(D,{size:"sm",animation:"border"}):"Save"}),e.jsx(y,{variant:"secondary",onClick:n,disabled:d,children:"Cancel"})]})]})}const G=()=>{var b;const{user:a,authenticatedFetch:n}=B(),[r,i]=c.useState([]),[f,l]=c.useState(!0),[h,d]=c.useState({key:"id",direction:"asc"}),[u,F]=c.useState({userName:""}),{apiBaseUrl:m,loading:g,error:j}=M();if(c.useEffect(()=>{g||!m||(l(!0),n(`${m}/v2/api/users`).then(s=>{if(!s.ok)throw new Error("Failed to fetch users");return s.json()}).then(s=>i(s)).catch(s=>w.error(s.message||"Error loading users")).finally(()=>l(!1)))},[n,m,g]),g)return e.jsx("div",{className:"mt-4",children:"Loading configuration..."});if(j)return e.jsxs("div",{className:"mt-4 text-danger",children:["Config error: ",j.message||j.toString()]});const p=c.useMemo(()=>r.filter(s=>!u.userName||(s.userName||"").toLowerCase().includes(u.userName.toLowerCase())),[r,u]),C=c.useMemo(()=>[...p].sort((s,t)=>R(s,t,h.key,h.direction)),[p,h]),U=s=>{i(t=>t.map(S=>S.id===s.id?s:S))};return!a||!((b=a.roles)!=null&&b.includes("admin"))?e.jsx("div",{className:"mt-4 text-danger",children:"Access denied."}):e.jsxs("div",{className:"container mt-4",children:[e.jsx("h2",{className:"mb-3",children:"Users"}),e.jsx(o,{className:"mb-3",children:e.jsx(N,{className:"g-2",children:e.jsx(x,{xs:12,sm:6,md:4,lg:3,xl:2,children:e.jsx(o.Control,{size:"sm",placeholder:"Filter by User Name",value:u.userName,onChange:s=>F(t=>({...t,userName:s.target.value}))})})})}),f?e.jsx("div",{className:"text-center my-5",children:e.jsx(D,{animation:"border"})}):e.jsx(N,{className:"g-2",children:C.map(s=>e.jsx(x,{xs:12,sm:6,md:4,lg:3,xl:2,xxl:2,children:e.jsx(W,{user:s,onSave:U})},s.id))}),C.length===0&&!f&&e.jsx("div",{children:"No users found."})]})};export{G as default};
