import{j as e,F as u,R as w,a as I,S as D,P as i,b as P,B as F,M as v}from"./bootstrap-9hNhFV_4.js";import{r as n}from"./vendor-D-ycbrtU.js";import{u as A,y as G}from"./index-BZwL5IVb.js";import"./router-Cwzx9i8E.js";const O=[{key:"groupId",label:"Group ID"},{key:"groupCode",label:"Group Code"},{key:"line",label:"Line"},{key:"lineCode",label:"Line Code"},{key:"opsCode",label:"Ops Code"},{key:"inlineLogo",label:"Inline Logo"},{key:"bulletLogo",label:"Bullet Logo"},{key:"backLogo",label:"Back Logo"},{key:"gateLogo",label:"Gate Logo"},{key:"firstNumber",label:"First Number"},{key:"lastNumber",label:"Last Number"},{key:"defaultLanguage",label:"Default Language"},{key:"siteId",label:"Site ID"}],R=({group:c,onSave:h})=>{const[j,p]=n.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mb-3 shadow-sm group-card-mini text-truncate",style:{cursor:"pointer",minWidth:0,maxWidth:260,width:"100%"},onClick:()=>p(!0),children:e.jsxs(P.Body,{className:"p-2 d-flex flex-column align-items-start justify-content-between",children:[e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"ID:"})," ",c.groupId]}),e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"Code:"})," ",c.groupCode]}),e.jsxs("div",{className:"mb-2 text-truncate",style:{width:"100%",fontSize:"0.85em",color:"#888"},children:[e.jsx("strong",{children:"Line:"})," ",c.line]}),e.jsx(F,{variant:"outline-primary",size:"sm",className:"align-self-end",onClick:f=>{f.stopPropagation(),p(!0)},children:"Details"})]})}),e.jsx(U,{show:j,onHide:()=>p(!1),group:c,onSave:h})]})};function U({show:c,onHide:h,group:j,onSave:p,mode:f="edit"}){const[b,S]=n.useState(j||{}),[y,o]=n.useState(!1),{authenticatedFetch:k}=A();n.useEffect(()=>{S(j||{})},[j,c]);const t=a=>{const{name:m,value:C,type:L,checked:N}=a.target;S(r=>({...r,[m]:L==="checkbox"?N:C}))},d=async()=>{o(!0);try{const a="https://dailyapisimple-gjchg7exhrcxf5cc.centralus-01.azurewebsites.net";let m,C;if(m=await k(`${a}/api/GroupCodes`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)}),!m.ok)throw new Error("Failed to save group code");C=await m.json(),G.success("Group code updated"),p(C),h()}catch(a){G.error(a.message||"Error saving group code")}finally{o(!1)}};return e.jsxs(v,{show:c,onHide:h,size:"lg",centered:!0,contentClassName:"group-modal-responsive",children:[e.jsx(v.Header,{closeButton:!0,children:e.jsx(v.Title,{children:"Group Code Details"})}),e.jsx(v.Body,{style:{maxHeight:"60vh",overflowY:"auto",minHeight:200},children:e.jsx(u,{children:O.map(({key:a,label:m})=>e.jsxs(u.Group,{className:"mb-3",as:w,children:[e.jsx(u.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:m}),e.jsx(I,{sm:8,xs:7,children:e.jsx(u.Control,{name:a,value:b[a]??"",onChange:t,disabled:y||a==="groupId",readOnly:a==="groupId",type:typeof b[a]=="number"?"number":"text"})})]},a))})}),e.jsxs(v.Footer,{children:[e.jsx(F,{variant:"primary",onClick:d,disabled:y,children:y?e.jsx(D,{size:"sm",animation:"border"}):"Save"}),e.jsx(F,{variant:"secondary",onClick:h,disabled:y,children:"Cancel"})]})]})}const $=()=>{var E;const{user:c,authenticatedFetch:h}=A(),[j,p]=n.useState([]),[f,b]=n.useState(!0),[S,y]=n.useState({key:"groupId",direction:"asc"}),[o,k]=n.useState({line:"",groupCode:""}),[t,d]=n.useState(1),[a,m]=n.useState(20),[C,L]=n.useState(0);n.useEffect(()=>{b(!0);const s="https://dailyapisimple-gjchg7exhrcxf5cc.centralus-01.azurewebsites.net",l=new URLSearchParams;l.append("skip",(t-1)*a),l.append("top",a),o.line&&l.append("line",o.line),o.groupCode&&l.append("groupCode",o.groupCode),h(`${s}/api/GroupCodes?${l.toString()}`).then(async x=>{if(!x.ok)throw new Error("Failed to fetch group codes");const z=x.headers.get("x-total-items"),g=await x.json();p(Array.isArray(g)?g:g.data||[]),L(z?parseInt(z,10):Array.isArray(g)?g.length:g.totalCount||(g.data?g.data.length:0))}).catch(x=>G.error(x.message||"Error loading group codes")).finally(()=>b(!1))},[h,t,a,o.line,o.groupCode]);const N=j,r=Math.max(1,Math.ceil(C/a)),B=N;n.useEffect(()=>{d(1)},[o,S,a]);const M=s=>{p(l=>l.map(x=>x.groupId===s.groupId?s:x))};return!c||!((E=c.roles)!=null&&E.includes("admin"))?e.jsx("div",{className:"mt-4 text-danger",children:"Access denied."}):e.jsxs("div",{className:"container mt-4",children:[e.jsx("h2",{className:"mb-3",children:"Group Codes"}),e.jsx(u,{className:"mb-3",children:e.jsxs(w,{className:"g-2 align-items-end",children:[e.jsx(I,{xs:12,sm:6,md:4,lg:3,xl:2,children:e.jsx(u.Control,{size:"sm",placeholder:"Filter by Group Code",value:o.groupCode,onChange:s=>k(l=>({...l,groupCode:s.target.value}))})}),e.jsx(I,{xs:12,sm:6,md:4,lg:3,xl:2,children:e.jsx(u.Control,{size:"sm",placeholder:"Filter by Line",value:o.line,onChange:s=>k(l=>({...l,line:s.target.value}))})})]})}),f?e.jsx("div",{className:"text-center my-5",children:e.jsx(D,{animation:"border"})}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"g-2",children:B.map(s=>e.jsx(I,{xs:12,sm:6,md:4,lg:3,xl:2,xxl:2,children:e.jsx(R,{group:s,onSave:M})},s.groupId))}),r>1&&e.jsxs("div",{className:"d-flex justify-content-center align-items-center gap-3 mt-3 flex-wrap",children:[e.jsxs(i,{className:"mb-0",children:[e.jsx(i.First,{onClick:()=>d(1),disabled:t===1}),e.jsx(i.Prev,{onClick:()=>d(s=>Math.max(1,s-1)),disabled:t===1}),e.jsx(i.Item,{active:t===1,onClick:()=>d(1),children:1}),t>4&&e.jsx(i.Ellipsis,{disabled:!0}),Array.from({length:2},(s,l)=>t-2+l).filter(s=>s>1&&s<t).map(s=>e.jsx(i.Item,{onClick:()=>d(s),children:s},s)),t!==1&&t!==r&&e.jsx(i.Item,{active:!0,children:t}),Array.from({length:2},(s,l)=>t+1+l).filter(s=>s<r&&s>t).map(s=>e.jsx(i.Item,{onClick:()=>d(s),children:s},s)),t<r-3&&e.jsx(i.Ellipsis,{disabled:!0}),r>1&&e.jsx(i.Item,{active:t===r,onClick:()=>d(r),children:r}),e.jsx(i.Next,{onClick:()=>d(s=>Math.min(r,s+1)),disabled:t===r}),e.jsx(i.Last,{onClick:()=>d(r),disabled:t===r})]}),e.jsxs(u.Group,{controlId:"pageSizeSelect",className:"mb-0",children:[e.jsx(u.Label,{visuallyHidden:!0,children:"Items per page"}),e.jsx(u.Select,{size:"sm",value:a,onChange:s=>m(Number(s.target.value)),children:[10,20,30,50,100].map(s=>e.jsxs("option",{value:s,children:[s," per page"]},s))})]})]})]}),N.length===0&&!f&&e.jsx("div",{children:"No group codes found."})]})};export{$ as default};
//# sourceMappingURL=GroupCodes-BJ29tr4E.js.map
