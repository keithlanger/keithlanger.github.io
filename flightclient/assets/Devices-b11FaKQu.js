import{j as e,B as N,T as G,F as a,S as W,R as b,a as p,M as S,b as U}from"./bootstrap-loZ_3mSD.js";import{r as o}from"./vendor-CAgi6j6b.js";import{u as B,c as M,y as z}from"./index-BPMj-wsh.js";import"./router-BUXXEe8L.js";const f=[{key:"id",label:"ID"},{key:"name",label:"Name"},{key:"siteId",label:"Site ID"},{key:"ipAddress",label:"IP Address"},{key:"uid",label:"UID"},{key:"type",label:"Type"},{key:"manufacturer",label:"Manufacturer"},{key:"model",label:"Model"},{key:"operatingSystem",label:"Operating System"},{key:"active",label:"Active"},{key:"deviceConfigurationId",label:"Device Config ID"},{key:"availablePorts",label:"Available Ports"},{key:"userAgentId",label:"User Agent ID"}];function R(n,d,r,m){return n[r]==null&&d[r]==null?0:n[r]==null?1:d[r]==null?-1:typeof n[r]=="string"?m==="asc"?n[r].localeCompare(d[r]):d[r].localeCompare(n[r]):m==="asc"?n[r]-d[r]:d[r]-n[r]}const H=({device:n,onSave:d})=>{const[r,m]=o.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"mb-3 shadow-sm device-card-mini text-truncate",style:{cursor:"pointer",minWidth:0,maxWidth:260,width:"100%"},onClick:()=>m(!0),children:e.jsxs(U.Body,{className:"p-2 d-flex flex-column align-items-start justify-content-between",children:[e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"ID:"})," ",n.id]}),e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"Name:"})," ",n.name]}),e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"Active:"})," ",n.active?"Yes":"No"]}),e.jsxs("div",{className:"mb-2 text-truncate",style:{width:"100%",fontSize:"0.85em",color:"#888"},children:[e.jsx("strong",{children:"UID:"})," ",n.uid]}),e.jsx(N,{variant:"outline-primary",size:"sm",className:"align-self-end",onClick:u=>{u.stopPropagation(),m(!0)},children:"Details"})]})}),e.jsx(P,{show:r,onHide:()=>m(!1),device:n,onSave:d})]})};function P({show:n,onHide:d,device:r,onSave:m,mode:u="edit"}){var F;const x=(F=r==null?void 0:r.links)==null?void 0:F.userAgent,[c,y]=o.useState(()=>u==="add"?{...r,id:0}:r||{}),[h,A]=o.useState(!1),{authenticatedFetch:g}=B();o.useEffect(()=>{y(u==="add"?{...r,id:0}:r||{})},[r,n,u]);const C=s=>{const{name:l,value:E,type:L,checked:t}=s.target;y(i=>({...i,[l]:L==="checkbox"?t:E}))},{apiBaseUrl:v}=M(),O=async()=>{A(!0);try{if(!v)throw new Error("API base URL not loaded");let s,l;if(u==="add"){if(s=await g(`${v}/api/Devices`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),!s.ok)throw new Error("Failed to add device");l=await s.json(),z.success("Device added")}else{if(s=await g(`${v}/api/Devices/${c.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),!s.ok)throw new Error("Failed to save device");l=await s.json(),z.success("Device updated")}m(l),d()}catch(s){z.error(s.message||(u==="add"?"Error adding device":"Error saving device"))}finally{A(!1)}},w=x?f.filter(s=>s.key!=="userAgentId"):f,D=w.filter((s,l)=>l%2===0),I=w.filter((s,l)=>l%2===1);return e.jsxs(S,{show:n,onHide:d,size:"lg",centered:!0,contentClassName:"device-modal-responsive",children:[e.jsx(S.Header,{closeButton:!0,children:e.jsx(S.Title,{children:u==="add"?"Add New Device":"Device Details"})}),e.jsxs(S.Body,{style:{maxHeight:"60vh",overflowY:"auto",minHeight:200},children:[e.jsx(a,{children:e.jsxs(b,{children:[e.jsx(p,{xs:12,lg:6,children:D.map(({key:s,label:l})=>e.jsxs(a.Group,{className:"mb-3",as:b,children:[e.jsx(a.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:l}),e.jsx(p,{sm:8,xs:7,children:s==="active"?e.jsx(a.Check,{type:"checkbox",name:s,checked:!!c[s],onChange:C,disabled:h}):e.jsx(a.Control,{name:s,value:c[s]??"",onChange:C,disabled:h||s==="id"||s==="userAgentId",readOnly:s==="id"||s==="userAgentId",type:typeof c[s]=="number"?"number":"text"})})]},s))}),e.jsx(p,{xs:12,lg:6,children:I.map(({key:s,label:l})=>e.jsxs(a.Group,{className:"mb-3",as:b,children:[e.jsx(a.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:l}),e.jsx(p,{sm:8,xs:7,children:s==="active"?e.jsx(a.Check,{type:"checkbox",name:s,checked:!!c[s],onChange:C,disabled:h}):e.jsx(a.Control,{name:s,value:c[s]??"",onChange:C,disabled:h||s==="id"||s==="userAgentId",readOnly:s==="id"||s==="userAgentId",type:typeof c[s]=="number"?"number":"text"})})]},s))})]})}),x&&e.jsxs("fieldset",{className:"border rounded p-3 mb-3 bg-light",children:[e.jsxs("legend",{className:"w-auto mb-0 d-flex align-items-center",style:{fontSize:"1rem",fontWeight:600},children:[e.jsx("span",{role:"img","aria-label":"User Agent",style:{marginRight:6},children:"🧑‍💻"})," User Agent Information"]}),e.jsxs("div",{className:"d-flex flex-column gap-3",children:[e.jsxs(a.Group,{className:"w-100 mb-0",as:b,children:[e.jsx(a.Label,{column:!0,sm:5,xs:5,style:{fontWeight:500},children:"ID"}),e.jsx(p,{sm:7,xs:7,children:e.jsx(a.Control,{value:c.userAgentId??"",readOnly:!0,disabled:!0,style:{backgroundColor:"#e9ecef",color:"#495057"}})})]}),x.userAgentText&&e.jsxs(a.Group,{className:"w-100 mb-0",as:b,children:[e.jsx(a.Label,{column:!0,sm:5,xs:5,style:{fontWeight:500},children:"Agent"}),e.jsx(p,{sm:7,xs:7,children:e.jsx(a.Control,{value:x.userAgentText,readOnly:!0,style:{backgroundColor:"#e9ecef",color:"#495057",fontWeight:500}})})]}),x.description&&e.jsxs(a.Group,{className:"w-100 mb-0",as:b,children:[e.jsx(a.Label,{column:!0,sm:5,xs:5,style:{fontWeight:500},children:"Description"}),e.jsx(p,{sm:7,xs:7,children:e.jsx(a.Control,{value:x.description,readOnly:!0,style:{backgroundColor:"#e9ecef",color:"#495057"}})})]})]})]})]}),e.jsxs(S.Footer,{children:[e.jsx(N,{variant:"primary",onClick:O,disabled:h,children:h?e.jsx(W,{size:"sm",animation:"border"}):u==="add"?"Add":"Save"}),e.jsx(N,{variant:"secondary",onClick:d,disabled:h,children:"Cancel"})]})]})}const Y=()=>{var E,L;const{user:n,authenticatedFetch:d}=B(),[r,m]=o.useState([]),[u,x]=o.useState(!0),[c,y]=o.useState(f.reduce((t,i)=>({...t,[i.key]:""}),{})),[h,A]=o.useState(!1),[g,C]=o.useState({key:"id",direction:"asc"}),{apiBaseUrl:v,isLoading:O,error:w}=M();o.useEffect(()=>{v&&(x(!0),d(`${v}/api/devices`).then(t=>{if(!t.ok)throw new Error("Failed to fetch devices");return t.json()}).then(t=>m(t)).catch(t=>z.error(t.message||"Error loading devices")).finally(()=>x(!1)))},[d,v]);const D=o.useMemo(()=>r.filter(t=>f.every(({key:i})=>{var j;return c[i]?(j=t[i])==null?void 0:j.toString().toLowerCase().includes(c[i].toLowerCase()):!0})),[r,c]),I=o.useMemo(()=>[...D].sort((t,i)=>R(t,i,g.key,g.direction)),[D,g]),[F,s]=o.useState(!1),l=t=>{m(i=>i.findIndex(T=>T.id===t.id)!==-1?i.map(T=>T.id===t.id?t:T):[t,...i])};return O?e.jsx("div",{className:"mt-4",children:"Loading configuration..."}):w?e.jsxs("div",{className:"mt-4 text-danger",children:["Config error: ",w.message||w.toString()]}):!n||!((E=n.roles)!=null&&E.includes("admin")||(L=n.roles)!=null&&L.includes("device"))?e.jsx("div",{className:"mt-4 text-danger",children:"Access denied."}):e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("h2",{className:"mb-0",children:"Devices"}),e.jsx(N,{variant:"success",size:"sm",onClick:()=>s(!0),children:"+ Add new device"})]}),e.jsx(P,{show:F,onHide:()=>s(!1),device:{},onSave:l,mode:"add"}),e.jsx(G,{bordered:!0,size:"sm",className:"mb-4",children:e.jsxs("thead",{children:[e.jsx("tr",{children:(h?f:f.slice(0,3)).map(({key:t,label:i})=>e.jsxs("th",{style:{cursor:"pointer"},onClick:()=>C(j=>({key:t,direction:j.key===t&&j.direction==="asc"?"desc":"asc"})),children:[i," ",g.key===t?g.direction==="asc"?"▲":"▼":null]},t))}),e.jsx("tr",{children:(h?f:f.slice(0,3)).map(({key:t})=>e.jsx("th",{children:e.jsx(a.Control,{size:"sm",placeholder:"Filter",value:c[t],onChange:i=>y(j=>({...j,[t]:i.target.value}))})},t))}),e.jsx("tr",{children:e.jsx("th",{colSpan:f.length,className:"p-1 text-end",children:e.jsx(N,{variant:"outline-secondary",size:"sm",onClick:()=>A(t=>!t),"aria-expanded":h,children:h?"Hide advanced filters":"Show advanced filters"})})})]})}),u?e.jsx("div",{className:"text-center my-5",children:e.jsx(W,{animation:"border"})}):e.jsx(b,{className:"g-2",children:I.map(t=>e.jsx(p,{xs:12,sm:6,md:4,lg:3,xl:2,xxl:2,children:e.jsx(H,{device:t,onSave:l})},t.id))}),I.length===0&&!u&&e.jsx("div",{children:"No devices found."})]})};export{Y as default};
