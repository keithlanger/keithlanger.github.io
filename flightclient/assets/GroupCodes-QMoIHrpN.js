import{j as e,B as E,S as O,R as G,a as N,P as d,F as m,M as S,b as M}from"./bootstrap-DDHsVi9e.js";import{r}from"./vendor-D-ycbrtU.js";import{u as B,y as F}from"./index-cTzEwy8j.js";import"./router-Cwzx9i8E.js";const z=[{key:"id",label:"ID"},{key:"lineCode",label:"Line Code"},{key:"line",label:"Line"},{key:"firstNumber",label:"First Number"},{key:"lastNumber",label:"Last Number"},{key:"opsCode",label:"Ops Code"},{key:"inlineLogo",label:"Inline Logo"},{key:"bulletLogo",label:"Bullet Logo"},{key:"backLogo",label:"Back Logo"},{key:"gateLogo",label:"Gate Logo"},{key:"groupCode",label:"Group Code"},{key:"defaultLanguage",label:"Default Language"},{key:"siteId",label:"Site ID"}],R=({group:u,onSave:b})=>{const[x,g]=r.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"mb-3 shadow-sm group-card-mini text-truncate",style:{cursor:"pointer",minWidth:0,maxWidth:260,width:"100%"},onClick:()=>g(!0),children:e.jsxs(M.Body,{className:"p-2 d-flex flex-column align-items-start justify-content-between",children:[e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"ID:"})," ",u.id]}),e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"Code:"})," ",u.groupCode]}),e.jsxs("div",{className:"mb-2 text-truncate",style:{width:"100%",fontSize:"0.85em",color:"#888"},children:[e.jsx("strong",{children:"Line:"})," ",u.line]}),e.jsx(E,{variant:"outline-primary",size:"sm",className:"align-self-end",onClick:l=>{l.stopPropagation(),g(!0)},children:"Details"})]})}),e.jsx(T,{show:x,onHide:()=>g(!1),group:u,onSave:b})]})};function T({show:u,onHide:b,group:x,onSave:g,mode:l="edit"}){const[h,y]=r.useState(x||{}),[C,a]=r.useState(!1),{authenticatedFetch:o}=B();r.useEffect(()=>{y(l==="add"?{id:0,siteId:1,firstNumber:1,lastNumber:9999,defaultLanguage:"en"}:x||{})},[x,u,l]);const p=t=>{const{name:i,value:n,type:D,checked:L}=t.target;y(k=>({...k,[i]:D==="checkbox"?L:n}))},A=async()=>{a(!0);try{const t="https://dailyapisimple-gjchg7exhrcxf5cc.centralus-01.azurewebsites.net";let i,n;if(l==="add"){if(i=await o(`${t}/api/GroupCodes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}),!i.ok)throw new Error("Failed to create group code");n=await i.json(),F.success("Group code created")}else{if(i=await o(`${t}/api/GroupCodes/${h.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}),!i.ok)throw new Error("Failed to save group code");n=await i.json(),F.success("Group code updated")}g(n,l),b()}catch(t){F.error(t.message||(l==="add"?"Error creating group code":"Error saving group code"))}finally{a(!1)}},w=Math.ceil(z.length/2),I=z.slice(0,w),P=z.slice(w);return e.jsxs(S,{show:u,onHide:b,size:"lg",centered:!0,contentClassName:"group-modal-responsive",children:[e.jsx(S.Header,{closeButton:!0,children:e.jsx(S.Title,{children:l==="add"?"Add Group Code":"Group Code Details"})}),e.jsx(S.Body,{style:{maxHeight:"60vh",overflowY:"auto",minHeight:200},children:e.jsx(m,{children:e.jsxs(G,{children:[e.jsx(N,{xs:12,lg:6,children:I.map(({key:t,label:i})=>e.jsxs(m.Group,{className:"mb-3",as:G,children:[e.jsx(m.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:i}),e.jsx(N,{sm:8,xs:7,children:e.jsx(m.Control,{name:t,value:h[t]??"",onChange:p,disabled:C||t==="id"||t==="siteId",readOnly:t==="id"||t==="siteId",type:typeof h[t]=="number"?"number":"text",tabIndex:t==="siteId"?-1:void 0})})]},t))}),e.jsx(N,{xs:12,lg:6,children:P.map(({key:t,label:i})=>e.jsxs(m.Group,{className:"mb-3",as:G,children:[e.jsx(m.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:i}),e.jsx(N,{sm:8,xs:7,children:e.jsx(m.Control,{name:t,value:h[t]??"",onChange:p,disabled:C||t==="id"||t==="siteId",readOnly:t==="id"||t==="siteId",type:typeof h[t]=="number"?"number":"text",tabIndex:t==="siteId"?-1:void 0})})]},t))})]})})}),e.jsxs(S.Footer,{children:[e.jsx(E,{variant:"primary",onClick:A,disabled:C,children:C?e.jsx(O,{size:"sm",animation:"border"}):l==="add"?"Create":"Save"}),e.jsx(E,{variant:"secondary",onClick:b,disabled:C,children:"Cancel"})]})]})}const _=()=>{var k;const{user:u,authenticatedFetch:b}=B(),[x,g]=r.useState([]),[l,h]=r.useState(!0),[y,C]=r.useState({key:"id",direction:"asc"}),[a,o]=r.useState(1),[p,A]=r.useState(20),[w,I]=r.useState(0),[P,t]=r.useState(!1);r.useEffect(()=>{h(!0);const s="https://dailyapisimple-gjchg7exhrcxf5cc.centralus-01.azurewebsites.net",j=new URLSearchParams;j.append("skip",(a-1)*p),j.append("top",p),b(`${s}/api/GroupCodes?${j.toString()}`).then(async c=>{if(!c.ok)throw new Error("Failed to fetch group codes");const v=c.headers.get("x-total-items"),f=await c.json();g(Array.isArray(f)?f:f.data||[]),I(v?parseInt(v,10):Array.isArray(f)?f.length:f.totalCount||(f.data?f.data.length:0))}).catch(c=>F.error(c.message||"Error loading group codes")).finally(()=>h(!1))},[b,a,p]);const i=x,n=Math.max(1,Math.ceil((w||x.length)/p)),D=i;r.useEffect(()=>{o(1)},[y,p]);const L=(s,j)=>{j==="add"?(g(c=>[s,...c]),I(c=>c+1)):g(c=>c.map(v=>v.id===s.id?s:v))};return!u||!((k=u.roles)!=null&&k.includes("admin"))?e.jsx("div",{className:"mt-4 text-danger",children:"Access denied."}):e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h2",{className:"mb-0",children:"Group Codes"}),e.jsx(E,{variant:"success",onClick:()=>t(!0),children:"+ Add Group Code"})]}),e.jsx(T,{show:P,onHide:()=>t(!1),mode:"add",onSave:L}),l?e.jsx("div",{className:"text-center my-5",children:e.jsx(O,{animation:"border"})}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"g-2",children:D.map(s=>e.jsx(N,{xs:12,sm:6,md:4,lg:3,xl:2,xxl:2,children:e.jsx(R,{group:s,onSave:L})},s.id))}),x.length>0&&e.jsxs("div",{className:"d-flex justify-content-center align-items-center gap-3 mt-3 flex-wrap",children:[e.jsxs(d,{className:"mb-0",children:[e.jsx(d.First,{onClick:()=>o(1),disabled:a===1}),e.jsx(d.Prev,{onClick:()=>o(s=>Math.max(1,s-1)),disabled:a===1}),e.jsx(d.Item,{active:a===1,onClick:()=>o(1),children:1}),a>4&&e.jsx(d.Ellipsis,{disabled:!0}),Array.from({length:2},(s,j)=>a-2+j).filter(s=>s>1&&s<a).map(s=>e.jsx(d.Item,{onClick:()=>o(s),children:s},s)),a!==1&&a!==n&&e.jsx(d.Item,{active:!0,children:a}),Array.from({length:2},(s,j)=>a+1+j).filter(s=>s<n&&s>a).map(s=>e.jsx(d.Item,{onClick:()=>o(s),children:s},s)),a<n-3&&e.jsx(d.Ellipsis,{disabled:!0}),n>1&&e.jsx(d.Item,{active:a===n,onClick:()=>o(n),children:n}),e.jsx(d.Next,{onClick:()=>o(s=>Math.min(n,s+1)),disabled:a===n}),e.jsx(d.Last,{onClick:()=>o(n),disabled:a===n})]}),e.jsxs(m.Group,{controlId:"pageSizeSelect",className:"mb-0",children:[e.jsx(m.Label,{visuallyHidden:!0,children:"Items per page"}),e.jsx(m.Select,{size:"sm",value:p,onChange:s=>A(Number(s.target.value)),children:[10,20,30,50,100].map(s=>e.jsxs("option",{value:s,children:[s," per page"]},s))})]})]})]}),i.length===0&&!l&&e.jsx("div",{children:"No group codes found."})]})};export{_ as default};
//# sourceMappingURL=GroupCodes-QMoIHrpN.js.map
