import{j as e,B as M,S as O,R as A,a as w,P as b,F as g,M as S,b as D}from"./bootstrap-loZ_3mSD.js";import{r as c}from"./vendor-CAgi6j6b.js";import{u as B,y as P}from"./index-CV02oq1s.js";import"./router-CJeIsT-5.js";const z=[{key:"id",label:"ID"},{key:"lineCode",label:"Line Code"},{key:"line",label:"Line"},{key:"firstNumber",label:"First Number"},{key:"lastNumber",label:"Last Number"},{key:"opsCode",label:"Ops Code"},{key:"inlineLogo",label:"Inline Logo"},{key:"bulletLogo",label:"Bullet Logo"},{key:"backLogo",label:"Back Logo"},{key:"gateLogo",label:"Gate Logo"},{key:"groupCode",label:"Group Code"},{key:"defaultLanguage",label:"Default Language"},{key:"siteId",label:"Site ID"}],R=({group:x,onSave:N})=>{const[p,f]=c.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mb-3 shadow-sm group-card-mini text-truncate",style:{cursor:"pointer",minWidth:0,maxWidth:260,width:"100%"},onClick:()=>f(!0),children:e.jsxs(D.Body,{className:"p-2 d-flex flex-column align-items-start justify-content-between",children:[e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"ID:"})," ",x.id]}),e.jsxs("div",{className:"mb-1 text-truncate",style:{width:"100%"},children:[e.jsx("strong",{children:"Code:"})," ",x.groupCode]}),e.jsxs("div",{className:"mb-2 text-truncate",style:{width:"100%",fontSize:"0.85em",color:"#888"},children:[e.jsx("strong",{children:"Line:"})," ",x.line]}),e.jsx(M,{variant:"outline-primary",size:"sm",className:"align-self-end",onClick:m=>{m.stopPropagation(),f(!0)},children:"Details"})]})}),e.jsx(T,{show:p,onHide:()=>f(!1),group:x,onSave:N})]})};function T({show:x,onHide:N,group:p,onSave:f,mode:m="edit"}){const[t,y]=c.useState(p||{}),[v,i]=c.useState(!1),[u,h]=c.useState(""),{authenticatedFetch:L}=B();c.useEffect(()=>{y(m==="add"?{id:0,siteId:1,firstNumber:1,lastNumber:9999,defaultLanguage:"en"}:p||{}),h("")},[p,x,m]);const I=a=>{const{name:r,value:j,type:s,checked:o}=a.target;y(n=>({...n,[r]:s==="checkbox"?o:j})),h("")},F=async()=>{if(!t.lineCode||!t.line||!t.groupCode||t.firstNumber===void 0||t.firstNumber===""||t.lastNumber===void 0||t.lastNumber===""){h("Line Code, Line, Group Code, First Number, and Last Number are required.");return}const a=Number(t.firstNumber),r=Number(t.lastNumber);if(isNaN(a)||isNaN(r)||a<1||a>9999||r<1||r>9999){h("First Number and Last Number must be numbers between 1 and 9999.");return}if(a>r){h("First Number must be less than or equal to Last Number.");return}i(!0);try{const j="https://dailyapisimple-linux2-cbcscfeafkekg6ca.centralus-01.azurewebsites.net";let s,o;if(m==="add"){if(s=await L(`${j}/api/GroupCodes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),!s.ok){let n="Failed to create group code";try{const l=await s.json();l&&(l.error||l.message)&&(n=l.error||l.message)}catch{}throw new Error(n)}o=await s.json(),P.success("Group code created")}else{if(s=await L(`${j}/api/GroupCodes/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),!s.ok){let n="Failed to save group code";try{const l=await s.json();l&&(l.error||l.message)&&(n=l.error||l.message)}catch{}throw new Error(n)}o=await s.json(),P.success("Group code updated")}f(o,m),N()}catch(j){P.error(j.message||(m==="add"?"Error creating group code":"Error saving group code"))}finally{i(!1)}},G=Math.ceil(z.length/2),E=z.slice(0,G),k=z.slice(G),d=a=>{if(!u)return!1;if(a==="lineCode"&&(!t.lineCode||t.lineCode==="")||a==="line"&&(!t.line||t.line==="")||a==="groupCode"&&(!t.groupCode||t.groupCode===""))return!0;if(a==="firstNumber"){const r=Number(t.firstNumber);return t.firstNumber===void 0||t.firstNumber===""||isNaN(r)||r<1||r>9999||t.lastNumber!==void 0&&t.lastNumber!==""&&r>Number(t.lastNumber)}if(a==="lastNumber"){const r=Number(t.lastNumber);return t.lastNumber===void 0||t.lastNumber===""||isNaN(r)||r<1||r>9999||t.firstNumber!==void 0&&t.firstNumber!==""&&Number(t.firstNumber)>r}return!1};return e.jsxs(S,{show:x,onHide:N,size:"lg",centered:!0,contentClassName:"group-modal-responsive",children:[e.jsx(S.Header,{closeButton:!0,children:e.jsx(S.Title,{children:m==="add"?"Add Group Code":"Group Code Details"})}),e.jsxs(S.Body,{style:{maxHeight:"60vh",overflowY:"auto",minHeight:200},children:[u&&e.jsx("div",{className:"alert alert-danger py-2 mb-3",role:"alert",style:{fontSize:"0.95em"},children:u}),e.jsx(g,{children:e.jsxs(A,{children:[e.jsx(w,{xs:12,lg:6,children:E.map(({key:a,label:r})=>e.jsxs(g.Group,{className:"mb-3",as:A,children:[e.jsx(g.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:r}),e.jsx(w,{sm:8,xs:7,children:e.jsx(g.Control,{name:a,value:t[a]??"",onChange:I,disabled:v||a==="id"||a==="siteId",readOnly:a==="id"||a==="siteId",type:typeof t[a]=="number"?"number":"text",tabIndex:a==="siteId"?-1:void 0,isInvalid:d(a)})})]},a))}),e.jsx(w,{xs:12,lg:6,children:k.map(({key:a,label:r})=>e.jsxs(g.Group,{className:"mb-3",as:A,children:[e.jsx(g.Label,{column:!0,sm:4,xs:5,style:{fontWeight:500},children:r}),e.jsx(w,{sm:8,xs:7,children:e.jsx(g.Control,{name:a,value:t[a]??"",onChange:I,disabled:v||a==="id"||a==="siteId",readOnly:a==="id"||a==="siteId",type:typeof t[a]=="number"?"number":"text",tabIndex:a==="siteId"?-1:void 0,isInvalid:d(a)})})]},a))})]})})]}),e.jsxs(S.Footer,{children:[e.jsx(M,{variant:"primary",onClick:F,disabled:v,children:v?e.jsx(O,{size:"sm",animation:"border"}):m==="add"?"Create":"Save"}),e.jsx(M,{variant:"secondary",onClick:N,disabled:v,children:"Cancel"})]})]})}const _=()=>{var j;const{user:x,authenticatedFetch:N}=B(),[p,f]=c.useState([]),[m,t]=c.useState(!0),[y,v]=c.useState({key:"id",direction:"asc"}),[i,u]=c.useState(1),[h,L]=c.useState(20),[I,F]=c.useState(0),[G,E]=c.useState(!1);c.useEffect(()=>{t(!0);const s="https://dailyapisimple-linux2-cbcscfeafkekg6ca.centralus-01.azurewebsites.net",o=new URLSearchParams;o.append("skip",(i-1)*h),o.append("top",h),N(`${s}/api/GroupCodes?${o.toString()}`).then(async n=>{if(!n.ok)throw new Error("Failed to fetch group codes");const l=n.headers.get("x-total-items"),C=await n.json();f(Array.isArray(C)?C:C.data||[]),F(l?parseInt(l,10):Array.isArray(C)?C.length:C.totalCount||(C.data?C.data.length:0))}).catch(n=>P.error(n.message||"Error loading group codes")).finally(()=>t(!1))},[N,i,h]);const k=p,d=Math.max(1,Math.ceil((I||p.length)/h)),a=k;c.useEffect(()=>{u(1)},[y,h]);const r=(s,o)=>{o==="add"?(f(n=>[s,...n]),F(n=>n+1)):f(n=>n.map(l=>l.id===s.id?s:l))};return!x||!((j=x.roles)!=null&&j.includes("admin"))?e.jsx("div",{className:"mt-4 text-danger",children:"Access denied."}):e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h2",{className:"mb-0",children:"Group Codes"}),e.jsx(M,{variant:"success",onClick:()=>E(!0),children:"+ Add Group Code"})]}),e.jsx(T,{show:G,onHide:()=>E(!1),mode:"add",onSave:r}),m?e.jsx("div",{className:"text-center my-5",children:e.jsx(O,{animation:"border"})}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"g-2",children:a.map(s=>e.jsx(w,{xs:12,sm:6,md:4,lg:3,xl:2,xxl:2,children:e.jsx(R,{group:s,onSave:r})},s.id))}),p.length>0&&e.jsxs("div",{className:"d-flex justify-content-center align-items-center gap-3 mt-3 flex-wrap",children:[e.jsxs(b,{className:"mb-0",children:[e.jsx(b.First,{onClick:()=>u(1),disabled:i===1}),e.jsx(b.Prev,{onClick:()=>u(s=>Math.max(1,s-1)),disabled:i===1}),e.jsx(b.Item,{active:i===1,onClick:()=>u(1),children:1}),i>4&&e.jsx(b.Ellipsis,{disabled:!0}),Array.from({length:2},(s,o)=>i-2+o).filter(s=>s>1&&s<i).map(s=>e.jsx(b.Item,{onClick:()=>u(s),children:s},s)),i!==1&&i!==d&&e.jsx(b.Item,{active:!0,children:i}),Array.from({length:2},(s,o)=>i+1+o).filter(s=>s<d&&s>i).map(s=>e.jsx(b.Item,{onClick:()=>u(s),children:s},s)),i<d-3&&e.jsx(b.Ellipsis,{disabled:!0}),d>1&&e.jsx(b.Item,{active:i===d,onClick:()=>u(d),children:d}),e.jsx(b.Next,{onClick:()=>u(s=>Math.min(d,s+1)),disabled:i===d}),e.jsx(b.Last,{onClick:()=>u(d),disabled:i===d})]}),e.jsxs(g.Group,{controlId:"pageSizeSelect",className:"mb-0",children:[e.jsx(g.Label,{visuallyHidden:!0,children:"Items per page"}),e.jsx(g.Select,{size:"sm",value:h,onChange:s=>L(Number(s.target.value)),children:[10,20,30,50,100].map(s=>e.jsxs("option",{value:s,children:[s," per page"]},s))})]})]})]}),k.length===0&&!m&&e.jsx("div",{children:"No group codes found."})]})};export{_ as default};
//# sourceMappingURL=GroupCodes-CgKnpmN0.js.map
